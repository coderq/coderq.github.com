<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>CoderQ·博客</title>
  <subtitle>不积硅步无以至千里(旧博客地址：http://blog.coderq.net)</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://coderq.github.io/"/>
  <updated>2016-06-13T06:01:47.000Z</updated>
  <id>http://coderq.github.io/</id>
  
  <author>
    <name>CoderQ</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>node.js的一些实用技巧</title>
    <link href="http://coderq.github.io/2016/06/13/node-js-skill/"/>
    <id>http://coderq.github.io/2016/06/13/node-js-skill/</id>
    <published>2016-06-13T05:53:32.000Z</published>
    <updated>2016-06-13T06:01:47.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;u5982_u4F55_u4F7F_u7528pm2_u542F_u52A8http-server&quot;&gt;&lt;a href=&quot;#u5982_u4F55_u4F7F_u7528pm2_u542F_u52A8http-server&quot; class=&quot;headerlink&quot; title=&quot;如何使用pm2启动http-server&quot;&gt;&lt;/a&gt;如何使用pm2启动http-server&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// -- 后面可以填写http-server的参数&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pm2 start /usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/bin/http-server --name=frontend -- -p &lt;span class=&quot;number&quot;&gt;3002&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u5982_u4F55_u4F7F_u7528pm2_u542F_u52A8http-server&quot;&gt;&lt;a href=&quot;#u5982_u4F55_u4F7F_u7528pm2_u542F_u52A8http-server&quot; class=&quot;headerlink&quot; t
    
    </summary>
    
      <category term="node.js" scheme="http://coderq.github.io/categories/node-js/"/>
    
    
      <category term="http-server" scheme="http://coderq.github.io/tags/http-server/"/>
    
      <category term="javascript" scheme="http://coderq.github.io/tags/javascript/"/>
    
      <category term="node.js" scheme="http://coderq.github.io/tags/node-js/"/>
    
      <category term="pm2" scheme="http://coderq.github.io/tags/pm2/"/>
    
  </entry>
  
  <entry>
    <title>mac上启动nginx遇到80端口被占用的解决方法</title>
    <link href="http://coderq.github.io/2016/06/04/mac-80-it-works/"/>
    <id>http://coderq.github.io/2016/06/04/mac-80-it-works/</id>
    <published>2016-06-04T09:52:17.000Z</published>
    <updated>2016-06-04T09:55:24.000Z</updated>
    
    <content type="html">&lt;p&gt;今天启动nginx的时候，发现80端口被占用，用&lt;code&gt;ps -ef | grep nginx&lt;/code&gt;和&lt;code&gt;lsof -i:80&lt;/code&gt;都找不到，后来上网搜索后发现是apache的问题，具体为啥会莫名的多了个apache还不清楚，不过解决方案是执行下面的代码即可。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo apachectl stop&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;今天启动nginx的时候，发现80端口被占用，用&lt;code&gt;ps -ef | grep nginx&lt;/code&gt;和&lt;code&gt;lsof -i:80&lt;/code&gt;都找不到，后来上网搜索后发现是apache的问题，具体为啥会莫名的多了个apache还不清楚，不过解决方案是执行下
    
    </summary>
    
      <category term="mac" scheme="http://coderq.github.io/categories/mac/"/>
    
    
      <category term="apache" scheme="http://coderq.github.io/tags/apache/"/>
    
      <category term="mac" scheme="http://coderq.github.io/tags/mac/"/>
    
      <category term="nginx" scheme="http://coderq.github.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>sublime中配置使用eslint</title>
    <link href="http://coderq.github.io/2016/05/16/javascript-eslint-sublime/"/>
    <id>http://coderq.github.io/2016/05/16/javascript-eslint-sublime/</id>
    <published>2016-05-16T00:06:25.000Z</published>
    <updated>2016-06-13T06:02:42.000Z</updated>
    
    <content type="html">&lt;p&gt;之前一直使用jshint，只从用上了&lt;code&gt;async&lt;/code&gt;、&lt;code&gt;wait&lt;/code&gt;这些语法糖之后，发现jshint无法识别了，于是准备换&lt;code&gt;eslint&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;u5B89_u88C5&quot;&gt;&lt;a href=&quot;#u5B89_u88C5&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm install eslint -g&amp;#10;npm install babel-eslint -g&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;sublime_u63D2_u4EF6_u5B89_u88C5&quot;&gt;&lt;a href=&quot;#sublime_u63D2_u4EF6_u5B89_u88C5&quot; class=&quot;headerlink&quot; title=&quot;sublime插件安装&quot;&gt;&lt;/a&gt;sublime插件安装&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;安装 SublimeLinter &lt;/li&gt;
&lt;li&gt;安装 SublimeLinter-contrib-eslint&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;u914D_u7F6E&quot;&gt;&lt;a href=&quot;#u914D_u7F6E&quot; class=&quot;headerlink&quot; title=&quot;配置&quot;&gt;&lt;/a&gt;配置&lt;/h2&gt;&lt;p&gt;在项目目录下新建&lt;code&gt;.eslintrc&lt;/code&gt;文件&lt;br&gt;&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;&lt;span class=&quot;attribute&quot;&gt;env&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;browser&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;node&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;es6&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#125;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;&lt;span class=&quot;attribute&quot;&gt;parser&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;babel-eslint&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;&lt;span class=&quot;attribute&quot;&gt;ecmaFeatures&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &quot;&lt;span class=&quot;attribute&quot;&gt;jsx&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#125;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;&lt;span class=&quot;attribute&quot;&gt;rules&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;semi&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;always&quot;&lt;/span&gt;]&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;quotes&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;single&quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;你也可以执行&lt;code&gt;eslint --init&lt;/code&gt;自行配置。&lt;/p&gt;
&lt;h2 id=&quot;u6267_u884C&quot;&gt;&lt;a href=&quot;#u6267_u884C&quot; class=&quot;headerlink&quot; title=&quot;执行&quot;&gt;&lt;/a&gt;执行&lt;/h2&gt;&lt;p&gt;代码执行的时候，因为这些语法糖目前都还未被支持，所以需要使用babel进行降级。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;新建文件&lt;code&gt;.babelrc&lt;/code&gt;写入以下内容&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &quot;&lt;span class=&quot;attribute&quot;&gt;presets&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;[&lt;span class=&quot;string&quot;&gt;&quot;es2015&quot;&lt;/span&gt;]&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &quot;&lt;span class=&quot;attribute&quot;&gt;plugins&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;[&lt;span class=&quot;string&quot;&gt;&quot;syntax-async-functions&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;transform-regenerator&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;transform-runtime&quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;新建文件&lt;code&gt;package.json&lt;/code&gt;写入以下内容&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;&lt;span class=&quot;attribute&quot;&gt;babel-plugin-syntax-async-functions&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;^6.1.4&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;&lt;span class=&quot;attribute&quot;&gt;babel-plugin-transform-regenerator&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;^6.1.4&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;&lt;span class=&quot;attribute&quot;&gt;babel-plugin-transform-runtime&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;^6.1.4&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;&lt;span class=&quot;attribute&quot;&gt;babel-polyfill&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;^6.1.4&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;&lt;span class=&quot;attribute&quot;&gt;babel-preset-es2015&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;^6.1.4&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;&lt;span class=&quot;attribute&quot;&gt;request&lt;/span&gt;&quot;: &lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;^2.65.0&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;执行&lt;code&gt;npm i&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;u6D4B_u8BD5&quot;&gt;&lt;a href=&quot;#u6D4B_u8BD5&quot; class=&quot;headerlink&quot; title=&quot;测试&quot;&gt;&lt;/a&gt;测试&lt;/h2&gt;&lt;p&gt;将下面代码存于项目中的一个文本文件中，暂且命名为test.es7&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;pi&quot;&gt;&#39;use strict&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;async&lt;/span&gt; = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Promise&lt;/span&gt;((resolve, reject) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		setTimeout(() =&amp;gt; resolve(&lt;span class=&quot;string&quot;&gt;&#39;end&#39;&lt;/span&gt;), &lt;span class=&quot;number&quot;&gt;2000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; test = &lt;span class=&quot;keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; ret = &lt;span class=&quot;keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;async&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(ret);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;test();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;执行&lt;code&gt;babel-node test.es7&lt;/code&gt;。会在2秒后看到&lt;code&gt;end&lt;/code&gt;的输出。正常的项目开发中，我们还需要借助gulp等工具作为开发和发布工具。这里只做eslint示例就不再介绍。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;async与generator的区别在于，generator没有自动执行的功能，需要依赖co库才能执行，async有自动执行的功能，因此可以像普通函数一样执行。&lt;/em&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;之前一直使用jshint，只从用上了&lt;code&gt;async&lt;/code&gt;、&lt;code&gt;wait&lt;/code&gt;这些语法糖之后，发现jshint无法识别了，于是准备换&lt;code&gt;eslint&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;u5B89_u88C5&quot;&gt;&lt;a href=&quot;#
    
    </summary>
    
      <category term="javascript" scheme="http://coderq.github.io/categories/javascript/"/>
    
    
      <category term="eslint" scheme="http://coderq.github.io/tags/eslint/"/>
    
      <category term="javascript" scheme="http://coderq.github.io/tags/javascript/"/>
    
      <category term="sublime" scheme="http://coderq.github.io/tags/sublime/"/>
    
  </entry>
  
  <entry>
    <title>mongodb replica set配置与mongoose连接实例</title>
    <link href="http://coderq.github.io/2016/05/16/mongoose-replica-set/"/>
    <id>http://coderq.github.io/2016/05/16/mongoose-replica-set/</id>
    <published>2016-05-15T23:26:25.000Z</published>
    <updated>2016-05-16T06:04:22.000Z</updated>
    
    <content type="html">&lt;p&gt;mongodb的replica set是一个强大的功能，可以实现读写分离功能，有heartbeat功能，可以实现自动故障转移，比master-slave更强大。&lt;/p&gt;
&lt;h2 id=&quot;u914D_u7F6E&quot;&gt;&lt;a href=&quot;#u914D_u7F6E&quot; class=&quot;headerlink&quot; title=&quot;配置&quot;&gt;&lt;/a&gt;配置&lt;/h2&gt;&lt;h3 id=&quot;u4E3B_u673A1&quot;&gt;&lt;a href=&quot;#u4E3B_u673A1&quot; class=&quot;headerlink&quot; title=&quot;主机1&quot;&gt;&lt;/a&gt;主机1&lt;/h3&gt;&lt;p&gt;保存在/etc/mongodb_1.conf&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;systemLog:&amp;#10;   path: &amp;#34;/var/log/mongodb/mongodb_1.log&amp;#34;&amp;#10;   logAppend: true&amp;#10;storage:&amp;#10;   journal:&amp;#10;      enabled: true&amp;#10;   dbPath: &amp;#34;/var/lib/mongodb_1&amp;#34;&amp;#10;processManagement:&amp;#10;   fork: true&amp;#10;   pidFilePath: &amp;#34;/var/run/mongodb/mongodb_1.pid&amp;#34;&amp;#10;net:&amp;#10;   bindIp: 127.0.0.1&amp;#10;   port: 27017&amp;#10;setParameter:&amp;#10;   enableLocalhostAuthBypass: false&amp;#10;replication:&amp;#10;   oplogSizeMB: 1000&amp;#10;   replSetName: &amp;#39;local-test&amp;#39;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;u4E3B_u673A2&quot;&gt;&lt;a href=&quot;#u4E3B_u673A2&quot; class=&quot;headerlink&quot; title=&quot;主机2&quot;&gt;&lt;/a&gt;主机2&lt;/h3&gt;&lt;p&gt;保存在/etc/mongodb_2.conf&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;systemLog:&amp;#10;   path: &amp;#34;/var/log/mongodb/mongodb_2.log&amp;#34;&amp;#10;   logAppend: true&amp;#10;storage:&amp;#10;   journal:&amp;#10;      enabled: true&amp;#10;   dbPath: &amp;#34;/var/lib/mongodb_2&amp;#34;&amp;#10;processManagement:&amp;#10;   fork: true&amp;#10;   pidFilePath: &amp;#34;/var/run/mongodb/mongodb_2.pid&amp;#34;&amp;#10;net:&amp;#10;   bindIp: 127.0.0.1&amp;#10;   port: 27017&amp;#10;setParameter:&amp;#10;   enableLocalhostAuthBypass: false&amp;#10;replication:&amp;#10;   oplogSizeMB: 1000&amp;#10;   replSetName: &amp;#39;local-test&amp;#39;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;u4E3B_u673A3&quot;&gt;&lt;a href=&quot;#u4E3B_u673A3&quot; class=&quot;headerlink&quot; title=&quot;主机3&quot;&gt;&lt;/a&gt;主机3&lt;/h3&gt;&lt;p&gt;保存在/etc/mongodb_3.conf&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;systemLog:&amp;#10;   path: &amp;#34;/var/log/mongodb/mongodb_3.log&amp;#34;&amp;#10;   logAppend: true&amp;#10;storage:&amp;#10;   journal:&amp;#10;      enabled: true&amp;#10;   dbPath: &amp;#34;/var/lib/mongodb_3&amp;#34;&amp;#10;processManagement:&amp;#10;   fork: true&amp;#10;   pidFilePath: &amp;#34;/var/run/mongodb/mongodb_3.pid&amp;#34;&amp;#10;net:&amp;#10;   bindIp: 127.0.0.1&amp;#10;   port: 27017&amp;#10;setParameter:&amp;#10;   enableLocalhostAuthBypass: false&amp;#10;replication:&amp;#10;   oplogSizeMB: 1000&amp;#10;   replSetName: &amp;#39;local-test&amp;#39;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;u542F_u52A8&quot;&gt;&lt;a href=&quot;#u542F_u52A8&quot; class=&quot;headerlink&quot; title=&quot;启动&quot;&gt;&lt;/a&gt;启动&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mongod -f /etc/mongodb.conf  &amp;#10;mongod -f /etc/mongodb_2.conf  &amp;#10;mongod -f /etc/mongodb_3.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;u8BBE_u7F6E&quot;&gt;&lt;a href=&quot;#u8BBE_u7F6E&quot; class=&quot;headerlink&quot; title=&quot;设置&quot;&gt;&lt;/a&gt;设置&lt;/h2&gt;&lt;p&gt;通过mongo命令，连接某一台机器，输入下面的配置命令，priority用来标示机器的优先权，优先权高的机器为primary机器，其他机器为secondary，当primary机器故障时，replica set 自动选择剩下机器中priority最高的作为primary机器。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// &amp;#37197;&amp;#32622;&amp;#20449;&amp;#24687;&amp;#10;var config = &amp;#123;_id:&amp;#34;repmore&amp;#34;,members:[&amp;#123;_id:0,host:&amp;#39;127.0.0.1:27017&amp;#39;,priority :2&amp;#125;,&amp;#123;_id:1,host:&amp;#39;127.0.0.1:27018&amp;#39;,priority:1&amp;#125;,&amp;#123;_id:2,host:&amp;#39;127.0.0.1:27019&amp;#39;,priority:1&amp;#125;]&amp;#125;;&amp;#10;// replica set &amp;#21021;&amp;#22987;&amp;#21270;&amp;#10;rs.initiate(config);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;u6D4B_u8BD5&quot;&gt;&lt;a href=&quot;#u6D4B_u8BD5&quot; class=&quot;headerlink&quot; title=&quot;测试&quot;&gt;&lt;/a&gt;测试&lt;/h2&gt;&lt;p&gt;目前，通过mongo链接三台机器，会发现27017位primiary，其他为secondary。&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;local-test:SECONDARY&amp;gt; rs.slaveOk()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;local-test:SECONDARY&amp;gt; rs.status()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&quot;set&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;local-test&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&quot;date&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T23:56:34.146Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&quot;myState&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&quot;members&quot;&lt;/span&gt; : [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;127.0.0.1:27017&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;health&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;state&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;stateStr&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;PRIMARY&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;uptime&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;43848&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optime&quot;&lt;/span&gt; : Timestamp(&lt;span class=&quot;number&quot;&gt;1463323447&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optimeDate&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T14:44:07Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;lastHeartbeat&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T23:56:32.643Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;lastHeartbeatRecv&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T23:56:32.641Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;pingMs&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;electionTime&quot;&lt;/span&gt; : Timestamp(&lt;span class=&quot;number&quot;&gt;1463312747&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;electionDate&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T11:45:47Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;configVersion&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;127.0.0.1:27018&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;health&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;state&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;stateStr&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;SECONDARY&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;uptime&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;48134&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optime&quot;&lt;/span&gt; : Timestamp(&lt;span class=&quot;number&quot;&gt;1463323447&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optimeDate&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T14:44:07Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;configVersion&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;self&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;127.0.0.1:27019&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;health&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;state&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;stateStr&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;SECONDARY&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;uptime&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;45603&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optime&quot;&lt;/span&gt; : Timestamp(&lt;span class=&quot;number&quot;&gt;1463323447&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optimeDate&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T14:44:07Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;lastHeartbeat&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T23:56:32.279Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;lastHeartbeatRecv&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T23:56:32.279Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;pingMs&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;configVersion&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&quot;ok&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;我们kill掉primary机器后，27018、27019会随机选择一台变为primary，因为他们两者的priority是一样的。&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;local-test:SECONDARY&amp;gt; rs.status()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&quot;set&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;local-test&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&quot;date&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T23:58:06.082Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&quot;myState&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&quot;members&quot;&lt;/span&gt; : [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;127.0.0.1:27017&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;health&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;state&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;stateStr&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;(not reachable/healthy)&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;uptime&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optime&quot;&lt;/span&gt; : Timestamp(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optimeDate&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;1970-01-01T00:00:00Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;lastHeartbeat&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T23:58:04.925Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;lastHeartbeatRecv&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T23:57:56.777Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;pingMs&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;lastHeartbeatMessage&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;Failed attempt to connect to 127.0.0.1:27017; couldn&#39;t connect to server 127.0.0.1:27017 (127.0.0.1), connection attempt failed&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;configVersion&quot;&lt;/span&gt; : -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;127.0.0.1:27018&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;health&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;state&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;stateStr&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;SECONDARY&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;uptime&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;48226&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optime&quot;&lt;/span&gt; : Timestamp(&lt;span class=&quot;number&quot;&gt;1463323447&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optimeDate&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T14:44:07Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;configVersion&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;self&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;127.0.0.1:27019&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;health&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;state&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;stateStr&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;PRIMARY&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;uptime&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;45695&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optime&quot;&lt;/span&gt; : Timestamp(&lt;span class=&quot;number&quot;&gt;1463323447&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;optimeDate&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T14:44:07Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;lastHeartbeat&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T23:58:04.452Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;lastHeartbeatRecv&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T23:58:04.451Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;pingMs&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;electionTime&quot;&lt;/span&gt; : Timestamp(&lt;span class=&quot;number&quot;&gt;1463356678&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;electionDate&quot;&lt;/span&gt; : ISODate(&lt;span class=&quot;string&quot;&gt;&quot;2016-05-15T23:57:58Z&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;configVersion&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&quot;ok&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;mongoose_u94FE_u63A5_u5B9E_u4F8B&quot;&gt;&lt;a href=&quot;#mongoose_u94FE_u63A5_u5B9E_u4F8B&quot; class=&quot;headerlink&quot; title=&quot;mongoose链接实例&quot;&gt;&lt;/a&gt;mongoose链接实例&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#39;use strict&amp;#39;;&amp;#10;&amp;#10;var mongoose = require(&amp;#39;mongoose&amp;#39;);&amp;#10;&amp;#10;mongoose.connect(&amp;#39;mongodb://127.0.0.1:27017/test&amp;#39;, &amp;#123;&amp;#10;&amp;#9;db: &amp;#123; native_parser: true &amp;#125;,&amp;#10;  &amp;#9;server: &amp;#123; poolSize: 5 &amp;#125;,&amp;#10;  &amp;#9;replset: &amp;#123; rs_name: &amp;#39;local-test&amp;#39; &amp;#125;&amp;#10;&amp;#125;, function(err) &amp;#123;&amp;#10;&amp;#9;if (err) throw err;&amp;#10;&amp;#125;);&amp;#10;&amp;#10;var Cat = mongoose.model(&amp;#39;Cat&amp;#39;, &amp;#123; name: String &amp;#125;);&amp;#10;&amp;#10;var kitty = new Cat(&amp;#123; name: &amp;#39;Zildjian&amp;#39; &amp;#125;);&amp;#10;kitty.save(function (err) &amp;#123;&amp;#10;  if (err) &amp;#123;&amp;#10;    console.log(err);&amp;#10;  &amp;#125; else &amp;#123;&amp;#10;    console.log(&amp;#39;meow&amp;#39;);&amp;#10;  &amp;#125;&amp;#10;&amp;#125;);&amp;#10;&amp;#10;Cat.findOne(&amp;#123;&amp;#125;, function(err, data) &amp;#123;&amp;#10;&amp;#9;if (err) throw err;&amp;#10;&amp;#9;console.log(data);&amp;#10;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;mongodb的replica set是一个强大的功能，可以实现读写分离功能，有heartbeat功能，可以实现自动故障转移，比master-slave更强大。&lt;/p&gt;
&lt;h2 id=&quot;u914D_u7F6E&quot;&gt;&lt;a href=&quot;#u914D_u7F6E&quot; class=&quot;h
    
    </summary>
    
      <category term="mongodb" scheme="http://coderq.github.io/categories/mongodb/"/>
    
    
      <category term="mongodb" scheme="http://coderq.github.io/tags/mongodb/"/>
    
      <category term="mongoose" scheme="http://coderq.github.io/tags/mongoose/"/>
    
  </entry>
  
  <entry>
    <title>Mongodb中一些不常用的命令备忘</title>
    <link href="http://coderq.github.io/2016/05/13/mongodb-seldom-command-note/"/>
    <id>http://coderq.github.io/2016/05/13/mongodb-seldom-command-note/</id>
    <published>2016-05-13T11:03:41.000Z</published>
    <updated>2016-05-17T11:10:59.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;u67E5_u627E_u7684_u51FA_u548C_u6B63_u5219_u8868_u8FBE_u5F0F_u4E0D_u5339_u914D_u7684_u6587_u6863&quot;&gt;&lt;a href=&quot;#u67E5_u627E_u7684_u51FA_u548C_u6B63_u5219_u8868_u8FBE_u5F0F_u4E0D_u5339_u914D_u7684_u6587_u6863&quot; class=&quot;headerlink&quot; title=&quot;查找的出和正则表达式不匹配的文档&quot;&gt;&lt;/a&gt;查找的出和正则表达式不匹配的文档&lt;/h1&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;db.favour.findOne(&amp;#123;&lt;span class=&quot;string&quot;&gt;&#39;floor_id&#39;&lt;/span&gt;: &amp;#123;$not: &lt;span class=&quot;regexp&quot;&gt;/^[0-9A-Za-z]&amp;#123;24,24&amp;#125;$/&lt;/span&gt;&amp;#125;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;u67E5_u627E_u51FA_u6587_u6863_u4E2D_u67D0_u4E2A_u6570_u7EC4_u5143_u7D20_u8D85_u8FC75_u7684_u6587_u6863&quot;&gt;&lt;a href=&quot;#u67E5_u627E_u51FA_u6587_u6863_u4E2D_u67D0_u4E2A_u6570_u7EC4_u5143_u7D20_u8D85_u8FC75_u7684_u6587_u6863&quot; class=&quot;headerlink&quot; title=&quot;查找出文档中某个数组元素超过5的文档&quot;&gt;&lt;/a&gt;查找出文档中某个数组元素超过5的文档&lt;/h1&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 查找出个数等于5的&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;db.floor.find(&amp;#123;item_list: &amp;#123;$size: &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;&amp;#125;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 查找出个数不等于5的&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;db.floor.find(&amp;#123;item_list: &amp;#123;$not: &amp;#123;$size: &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;&amp;#125;&amp;#125;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 查找出个数大于5的&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;db.floor.find(&amp;#123;$where: &lt;span class=&quot;string&quot;&gt;&#39;this.item_list &amp;amp;&amp;amp; this.item_list.length &amp;gt; 5&#39;&lt;/span&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;u67E5_u627E_u7684_u51FA_u548C_u6B63_u5219_u8868_u8FBE_u5F0F_u4E0D_u5339_u914D_u7684_u6587_u6863&quot;&gt;&lt;a href=&quot;#u67E5_u627E_u7684_u51FA_u
    
    </summary>
    
      <category term="mongodb" scheme="http://coderq.github.io/categories/mongodb/"/>
    
    
      <category term="mongodb" scheme="http://coderq.github.io/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>Nginx配置支持跨域</title>
    <link href="http://coderq.github.io/2016/05/13/cross-domain/"/>
    <id>http://coderq.github.io/2016/05/13/cross-domain/</id>
    <published>2016-05-13T09:45:56.000Z</published>
    <updated>2016-05-13T10:27:51.000Z</updated>
    
    <content type="html">&lt;p&gt;公司使用swagger作为接口文档容器，文档和接口的域名不同，需要跨域。遇到的最郁闷的坑是，没弄清楚各个属性的含义，导致Access-Control-Allow-Headers漏了两个key没加，一直请求失败。&lt;br&gt;&lt;figure class=&quot;highlight nginx&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;variable&quot;&gt;$request_method&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&#39;OPTIONS&#39;&lt;/span&gt;) &amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Origin&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;https://docs.domain.com&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Credentials&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;true&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Methods&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;GET, POST, PUT, DELETE, PATCH, OPTIONS&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Headers&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,token&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;204&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;variable&quot;&gt;$request_method&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&#39;POST&#39;&lt;/span&gt;) &amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Origin&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;https://docs.domain.com&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Credentials&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;true&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Methods&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;GET, POST, PUT, DELETE, PATCH, OPTIONS&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Headers&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,token&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;variable&quot;&gt;$request_method&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&#39;GET&#39;&lt;/span&gt;) &amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Origin&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;https://docs.domain.com&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Credentials&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;true&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Methods&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;GET, POST, PUT, DELETE, PATCH, OPTIONS&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;add_header&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Access-Control-Allow-Headers&#39;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,token&#39;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&quot;u8DE8_u57DF_u8D44_u6E90_u5171_u4EAB_u5934_u4FE1_u606F&quot;&gt;&lt;a href=&quot;#u8DE8_u57DF_u8D44_u6E90_u5171_u4EAB_u5934_u4FE1_u606F&quot; class=&quot;headerlink&quot; title=&quot;跨域资源共享头信息&quot;&gt;&lt;/a&gt;跨域资源共享头信息&lt;/h1&gt;&lt;p&gt;顺便学习下跨域共享的头信息&lt;/p&gt;
&lt;h2 id=&quot;Access-Control-Allow-Origin&quot;&gt;&lt;a href=&quot;#Access-Control-Allow-Origin&quot; class=&quot;headerlink&quot; title=&quot;Access-Control-Allow-Origin&quot;&gt;&lt;/a&gt;Access-Control-Allow-Origin&lt;/h2&gt;&lt;p&gt;origin参数指定一个允许向该服务器提交请求的URI.对于一个不带有credentials的请求,可以指定为’*’,表示允许来自所有域的请求.&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Access-Control-Allow-Origin: &amp;lt;origin&amp;gt; | *&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Access-Control-Expose-Headers&quot;&gt;&lt;a href=&quot;#Access-Control-Expose-Headers&quot; class=&quot;headerlink&quot; title=&quot;Access-Control-Expose-Headers&quot;&gt;&lt;/a&gt;Access-Control-Expose-Headers&lt;/h2&gt;&lt;p&gt;设置浏览器允许访问的服务器的头信息的白名单&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Access-Control-Expose-Headers: X-My-Custom-Header, X-Another-Custom-Header&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Access-Control-Max-Age&quot;&gt;&lt;a href=&quot;#Access-Control-Max-Age&quot; class=&quot;headerlink&quot; title=&quot;Access-Control-Max-Age&quot;&gt;&lt;/a&gt;Access-Control-Max-Age&lt;/h2&gt;&lt;p&gt;这个头告诉我们这次预请求的结果的有效期是多久&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Access-Control-Max-Age: &amp;lt;delta-seconds&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Access-Control-Allow-Credentials&quot;&gt;&lt;a href=&quot;#Access-Control-Allow-Credentials&quot; class=&quot;headerlink&quot; title=&quot;Access-Control-Allow-Credentials&quot;&gt;&lt;/a&gt;Access-Control-Allow-Credentials&lt;/h2&gt;&lt;p&gt;告知客户端,当请求的credientials属性是true的时候,响应是否可以被得到.当它作为预请求的响应的一部分时,它用来告知实际的请求是否使用了credentials.注意,简单的GET请求不会预检,所以如果一个请求是为了得到一个带有credentials的资源,而响应里又没有Access-Control-Allow-Credentials头信息,那么说明这个响应被忽略了.&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Access-Control-Allow-Credentials: true | false&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Access-Control-Allow-Methods&quot;&gt;&lt;a href=&quot;#Access-Control-Allow-Methods&quot; class=&quot;headerlink&quot; title=&quot;Access-Control-Allow-Methods&quot;&gt;&lt;/a&gt;Access-Control-Allow-Methods&lt;/h2&gt;&lt;p&gt;指明资源可以被请求的方式有哪些(一个或者多个). 这个响应头信息在客户端发出预检请求的时候会被返回. 上面有相关的例子.&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Access-Control-Allow-Methods: &amp;lt;method&amp;gt;[, &amp;lt;method&amp;gt;]*&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Access-Control-Allow-Headers&quot;&gt;&lt;a href=&quot;#Access-Control-Allow-Headers&quot; class=&quot;headerlink&quot; title=&quot;Access-Control-Allow-Headers&quot;&gt;&lt;/a&gt;Access-Control-Allow-Headers&lt;/h2&gt;&lt;p&gt;也是在响应预检请求的时候使用.用来指明在实际的请求中,可以使用哪些自定义HTTP请求头.&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Access-Control-Allow-Headers: X-PINGOTHER&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;就像我遇到的坑，必须把request header中的key都写到这里，否则是无法成功的。&lt;/p&gt;
&lt;h1 id=&quot;u9884_u8BF7_u6C42_u5934&quot;&gt;&lt;a href=&quot;#u9884_u8BF7_u6C42_u5934&quot; class=&quot;headerlink&quot; title=&quot;预请求头&quot;&gt;&lt;/a&gt;预请求头&lt;/h1&gt;&lt;h2 id=&quot;Origin&quot;&gt;&lt;a href=&quot;#Origin&quot; class=&quot;headerlink&quot; title=&quot;Origin&quot;&gt;&lt;/a&gt;Origin&lt;/h2&gt;&lt;p&gt;表明发送请求或者预请求的域&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Origin: &amp;lt;origin&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Access-Control-Request-Method&quot;&gt;&lt;a href=&quot;#Access-Control-Request-Method&quot; class=&quot;headerlink&quot; title=&quot;Access-Control-Request-Method&quot;&gt;&lt;/a&gt;Access-Control-Request-Method&lt;/h2&gt;&lt;p&gt;在发出预检请求时带有这个头信息,告诉服务器在实际请求时会使用的请求方式&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Access-Control-Request-Method: &amp;lt;method&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Access-Control-Request-Headers&quot;&gt;&lt;a href=&quot;#Access-Control-Request-Headers&quot; class=&quot;headerlink&quot; title=&quot;Access-Control-Request-Headers&quot;&gt;&lt;/a&gt;Access-Control-Request-Headers&lt;/h2&gt;&lt;p&gt;在发出预检请求时带有这个头信息,告诉服务器在实际请求时会携带的自定义头信息.如有多个,可以用逗号分开.&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Access-Control-Request-Headers: &amp;lt;field-name&amp;gt;[, &amp;lt;field-name&amp;gt;]*&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;公司使用swagger作为接口文档容器，文档和接口的域名不同，需要跨域。遇到的最郁闷的坑是，没弄清楚各个属性的含义，导致Access-Control-Allow-Headers漏了两个key没加，一直请求失败。&lt;br&gt;&lt;figure class=&quot;highlight ngi
    
    </summary>
    
      <category term="nginx" scheme="http://coderq.github.io/categories/nginx/"/>
    
    
      <category term="nginx" scheme="http://coderq.github.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>排序算法</title>
    <link href="http://coderq.github.io/2016/05/12/sorting-algorithms/"/>
    <id>http://coderq.github.io/2016/05/12/sorting-algorithms/</id>
    <published>2016-05-12T06:41:02.000Z</published>
    <updated>2016-05-19T06:23:33.000Z</updated>
    
    <content type="html">&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 插入排序：假设数组有n个元素，i = 1:n，若i &amp;lt; i-1，则交换两者，直到使得1到i的数组有序递增。时间复杂度O(N^2)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; *&lt;span class=&quot;title&quot;&gt;InsertSort&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ary[], &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; n)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i, j, z = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (i = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; i &amp;lt; n; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (j = i; j &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; j--) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ary[j] &amp;lt; ary[j - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                swap(&amp;amp;ary[j], &amp;amp;ary[j - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;span class=&quot;comment&quot;&gt;// 当i&amp;gt;=i-1时，接下去的比较无意义&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ary;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 选择排序：假设数组长度为n，i=1:n，从i+1到n中选择最小的一个和i交换。时间复杂度O(N^2)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; *&lt;span class=&quot;title&quot;&gt;SelectionSort&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ary[], &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; n)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i, j, k, z = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; n; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (k = i, j = i + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; j &amp;lt; n; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ary[k] &amp;gt; ary[j]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                k = j;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        swap(&amp;amp;ary[i], &amp;amp;ary[k]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ary;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 冒泡排序：假设数组长度为n，i=1:n-1，若i&amp;gt;i+1，则交换两者，直到使得1到n的数组有序递增。时间复杂度O(N^2)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; *&lt;span class=&quot;title&quot;&gt;BubbleSort&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ary[], &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; n)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i, j, z = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; swapped = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; n; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (j = n - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; j &amp;gt; i; j--) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ary[j] &amp;lt; ary[j - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                swap(&amp;amp;ary[j], &amp;amp;ary[j - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                swapped = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!swapped) &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ary;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 堆排序：假设数组长度为n，i=1:n/2-1，若i&amp;lt;2i，则交换两者，若i&amp;lt;2i+1，则交换两者，直到i=0结束，交换0和n-1的元素。n=n-1，重复操作，直到n=2。时间复杂度O(nlgn)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; *&lt;span class=&quot;title&quot;&gt;HeapSort&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ary[], &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; n, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; total)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (i = n / &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; i &amp;gt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i--) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ary[i] &amp;lt; ary[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; * i]) swap(&amp;amp;ary[i], &amp;amp;ary[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; * i]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ary[i] &amp;lt; ary[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; * i + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]) swap(&amp;amp;ary[i], &amp;amp;ary[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; * i + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    swap(&amp;amp;ary[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], &amp;amp;ary[n - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (n &amp;gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) HeapSort(ary, n - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, total);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ary;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 希尔排序：假设数组长度为n，步长g循环n&amp;gt;&amp;gt;1，i=g:n，为所有的j = i-g loop, j &amp;gt; 0做排序。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; *&lt;span class=&quot;title&quot;&gt;ShellSort&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ary[], &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; n)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; gap, i, j;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; temp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (gap = n &amp;gt;&amp;gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; gap &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; gap &amp;gt;&amp;gt;= &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (i = gap; i &amp;lt; n; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            temp = ary[i];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (j = i - gap; j &amp;gt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; ary[j] &amp;gt; temp; j -= gap) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ary[j + gap] = ary[j];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ary[j + gap] = temp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;本次排序结果：\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            printArray(ary, n);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ary;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 快速排序&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; _QuickSort(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ary[], &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; start, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; end)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (start &amp;gt;= end) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; l = start, r = end - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (l &amp;lt; r) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (l &amp;lt; r &amp;amp;&amp;amp; ary[l] &amp;lt; ary[end]) ++l;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (l &amp;lt; r &amp;amp;&amp;amp; ary[r] &amp;gt;= ary[end]) --r;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (l != r) swap(&amp;amp;ary[l], &amp;amp;ary[r]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;111本次排序结果：\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;l: %d, r: %d, s: %d, e: %d\n&quot;&lt;/span&gt;, l, r, start, end);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        printArray(ary, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ary[l] &amp;gt; ary[end]) swap(&amp;amp;ary[end], &amp;amp;ary[l]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; l++; &lt;span class=&quot;comment&quot;&gt;// l++是为了保护已经在有序位上的元素，例如为8，7，9排序，l指向7的索引1，但明显9最大，9后面没有更多的数据需要排序，仅需要对8和7做排序，因此l++，使得l的值为2，仅对8，7做排序&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;222本次排序结果：\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;l: %d, r: %d, s: %d, e: %d\n&quot;&lt;/span&gt;, l, r, start, end);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    printArray(ary, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _QuickSort(ary, start, l - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _QuickSort(ary, l + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, end);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; *&lt;span class=&quot;title&quot;&gt;QuickSort&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ary[], &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; n)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _QuickSort(ary, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, n - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ary;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 未完，待续。。。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;u4EA4_u6362_u6392_u5E8F&quot;&gt;&lt;a href=&quot;#u4EA4_u6362_u6392_u5E8F&quot; class=&quot;headerlink&quot; title=&quot;交换排序&quot;&gt;&lt;/a&gt;交换排序&lt;/h1&gt;&lt;h2 id=&quot;u5192_u6CE1_u6392_u5E8F&quot;&gt;&lt;a href=&quot;#u5192_u6CE1_u6392_u5E8F&quot; class=&quot;headerlink&quot; title=&quot;冒泡排序&quot;&gt;&lt;/a&gt;冒泡排序&lt;/h2&gt;&lt;h3 id=&quot;u7B97_u6CD5_u63CF_u8FF0&quot;&gt;&lt;a href=&quot;#u7B97_u6CD5_u63CF_u8FF0&quot; class=&quot;headerlink&quot; title=&quot;算法描述&quot;&gt;&lt;/a&gt;算法描述&lt;/h3&gt;&lt;p&gt;假设数组ary长度为N，i=0:N-1，j=N-1:i+1，如果ary[j-1] &amp;gt; ary[j]，则swap(ary[j - 1], ary[j]);&lt;/p&gt;
&lt;h3 id=&quot;u7B97_u6CD5&quot;&gt;&lt;a href=&quot;#u7B97_u6CD5&quot; class=&quot;headerlink&quot; title=&quot;算法&quot;&gt;&lt;/a&gt;算法&lt;/h3&gt;&lt;h3 id=&quot;u7B97_u6CD5_u5B9E_u73B0&quot;&gt;&lt;a href=&quot;#u7B97_u6CD5_u5B9E_u73B0&quot; class=&quot;headerlink&quot; title=&quot;算法实现&quot;&gt;&lt;/a&gt;算法实现&lt;/h3&gt;&lt;h2 id=&quot;u9E21_u5C3E_u9152_u6392_u5E8F&quot;&gt;&lt;a href=&quot;#u9E21_u5C3E_u9152_u6392_u5E8F&quot; class=&quot;headerlink&quot; title=&quot;鸡尾酒排序&quot;&gt;&lt;/a&gt;鸡尾酒排序&lt;/h2&gt;&lt;p&gt;鸡尾酒排序是冒泡排序的一个变种，冒泡排序是一个方向从头排到尾，鸡尾酒排序是双向同时排序。&lt;/p&gt;
&lt;h3 id=&quot;u7B97_u6CD5_u63CF_u8FF0-1&quot;&gt;&lt;a href=&quot;#u7B97_u6CD5_u63CF_u8FF0-1&quot; class=&quot;headerlink&quot; title=&quot;算法描述&quot;&gt;&lt;/a&gt;算法描述&lt;/h3&gt;&lt;p&gt;假设数组ary长度为N，无限循环做以下处理，i=0:N-2，如果ary[i]大于ary[i + 1]，则swap(ary[i], ary[i + 1])，设置swapped=true，退出i的循环；j=N-2:0，如果ary[j]大于ary[j + 1]，则swap(ary[j], ary[j + 1])，设置swapped=true，退出j的循环。如果swapped!=true，说明已经有序，则退出无限循环。&lt;/p&gt;
&lt;h2 id=&quot;u5947_u5076_u6392_u5E8F&quot;&gt;&lt;a href=&quot;#u5947_u5076_u6392_u5E8F&quot; class=&quot;headerlink&quot; title=&quot;奇偶排序&quot;&gt;&lt;/a&gt;奇偶排序&lt;/h2&gt;&lt;p&gt;奇偶排序是一个不断比较左右两个值大小的算法，当左值大于右值时，做交换操作，直到交换不再发生，则排序结束。&lt;/p&gt;
&lt;h3 id=&quot;u7B97_u6CD5_u63CF_u8FF0-2&quot;&gt;&lt;a href=&quot;#u7B97_u6CD5_u63CF_u8FF0-2&quot; class=&quot;headerlink&quot; title=&quot;算法描述&quot;&gt;&lt;/a&gt;算法描述&lt;/h3&gt;&lt;p&gt;假设数组ary长度为N，无限循环做以下处理，i=0:1，j=i:N-1;step=2，若ary[j]大于ary[j + 1]则交换两者，swapped赋值为true，当swapped不为true时，退出无限循环。&lt;/p&gt;
&lt;h2 id=&quot;u68B3_u6392_u5E8F&quot;&gt;&lt;a href=&quot;#u68B3_u6392_u5E8F&quot; class=&quot;headerlink&quot; title=&quot;梳排序&quot;&gt;&lt;/a&gt;梳排序&lt;/h2&gt;&lt;h2 id=&quot;u4F8F_u5112_u6392_u5E8F&quot;&gt;&lt;a href=&quot;#u4F8F_u5112_u6392_u5E8F&quot; class=&quot;headerlink&quot; title=&quot;侏儒排序&quot;&gt;&lt;/a&gt;侏儒排序&lt;/h2&gt;&lt;h2 id=&quot;u6876_u6392_u5E8F&quot;&gt;&lt;a href=&quot;#u6876_u6392_u5E8F&quot; class=&quot;headerlink&quot; title=&quot;桶排序&quot;&gt;&lt;/a&gt;桶排序&lt;/h2&gt;&lt;p&gt;假设数组有N个元素，初始化M（M根据情况决定）个桶，将N个元素根据规则放入M个桶内，并排好序，最后将所有桶合并并排序。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;li
    
    </summary>
    
      <category term="算法" scheme="http://coderq.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="算法" scheme="http://coderq.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>算法中的增长率标记法及含义</title>
    <link href="http://coderq.github.io/2016/05/11/algorithm-rate-of-increase/"/>
    <id>http://coderq.github.io/2016/05/11/algorithm-rate-of-increase/</id>
    <published>2016-05-11T15:08:03.000Z</published>
    <updated>2016-05-11T15:22:20.000Z</updated>
    
    <content type="html">&lt;ul&gt;
&lt;li&gt;&lt;code&gt;T(N) = O(f(N))&lt;/code&gt; 表示T(N)的增长率小于等于f(N)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;T(N) = Ω(g(N))&lt;/code&gt; 表示T(N)的增长率大于等于f(N)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;T(N) = θ(h(N))&lt;/code&gt; 表示T(N)的增长率等于h(N)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;T(N) = o(p(N))&lt;/code&gt; 表示T(N)的增长率等于p(N)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;当且仅当&lt;code&gt;T(N) = O(f(N))&lt;/code&gt;且&lt;code&gt;T(N) = Ω(f(N))&lt;/code&gt;时，&lt;code&gt;T(N) = θ(h(N))&lt;/code&gt;。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;&lt;code&gt;T(N) = O(f(N))&lt;/code&gt; 表示T(N)的增长率小于等于f(N)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;T(N) = Ω(g(N))&lt;/code&gt; 表示T(N)的增长率大于等于f(N)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;T(N) = θ(h(N)
    
    </summary>
    
      <category term="算法" scheme="http://coderq.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="算法" scheme="http://coderq.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>常用数学公式</title>
    <link href="http://coderq.github.io/2016/05/06/formula/"/>
    <id>http://coderq.github.io/2016/05/06/formula/</id>
    <published>2016-05-05T23:25:25.000Z</published>
    <updated>2016-05-07T06:57:30.000Z</updated>
    
    <content type="html">&lt;p&gt;最近复习算法和数据结构，记录下一些数学公式，顺便了解下latex。&lt;/p&gt;
&lt;h2 id=&quot;u6307_u6570&quot;&gt;&lt;a href=&quot;#u6307_u6570&quot; class=&quot;headerlink&quot; title=&quot;指数&quot;&gt;&lt;/a&gt;指数&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula/X%5E%7BA%7DX%5E%7BB%7D%20=%20X%5E%7BA+B%7D.png&quot; alt=&quot;X^{A}X^{B} = X^{A+B}&quot; title=&quot;X^{A}X^{B} = X^{A+B}&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula/%5Cfrac%7BX%5E%7BA%7D%7D%7BX%5E%7BB%7D%7D%20=%20X%5E%7BA-B%7D.png&quot; alt=&quot;\frac{X^{A}}{X^{B}} = X^{A-B}&quot; title=&quot;\frac{X^{A}}{X^{B}} = X^{A-B}&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula/%28X%5E%7BA%7D%29%5E%7BB%7D%20=%20X%5E%7BAB%7D.png&quot; alt=&quot;(X^{A})^{B} = X^{AB}&quot; title=&quot;(X^{A})^{B} = X^{AB}&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula/X%5E%7BN%7D%20+%20X%5E%7BN%7D%20=%202X%5E%7BN%7D%20%5Cneq%20X%5E%7B2N%7D.png&quot; alt=&quot;X^{N} + X^{N} = 2X^{N} \neq X^{2N}&quot; title=&quot;X^{N} + X^{N} = 2X^{N} \neq X^{2N}&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula/2%5E%7BN%7D%20+%202%5E%7BN%7D%20=%202%20%2A%202%5E%7BN%7D%20=%202%5E%7BN%20+%201%7D.png&quot; alt=&quot;2^{N} + 2^{N} = 2 * 2^{N} = 2^{N + 1}&quot; title=&quot;2^{N} + 2^{N} = 2 * 2^{N} = 2^{N + 1}&quot;&gt;&lt;br&gt;&lt;/p&gt;
&lt;h2 id=&quot;u5BF9_u6570&quot;&gt;&lt;a href=&quot;#u5BF9_u6570&quot; class=&quot;headerlink&quot; title=&quot;对数&quot;&gt;&lt;/a&gt;对数&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula/%5Clog_%7BA%7D%7BB%7D%20=%20%5Cfrac%7B%5Clog_%7BC%7D%7BB%7D%7D%7B%5Clog_%7BC%7D%7BA%7D%7D;%20C%20%3E%200.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula/%5Clog_%7B%20%7D%7BAB%7D%20=%20%5Clog_%7B%20%7D%7BA%7D%20+%20%5Clog_%7B%20%7D%7BB%7D.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula/%5Clog_%7B%20%7D%7B%5Cfrac%7BA%7D%7BB%7D%7D%20=%20%5Clog_%7B%20%7D%7BA%7D%20-%20%5Clog_%7B%20%7D%7BB%7D.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula/%5Clog_%7B%20%7D%7BA%5E%7BB%7D%7D%20=%20B%5Clog_%7B%20%7D%7BA%7D.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;/p&gt;
&lt;h2 id=&quot;u7EA7_u6570&quot;&gt;&lt;a href=&quot;#u7EA7_u6570&quot; class=&quot;headerlink&quot; title=&quot;级数&quot;&gt;&lt;/a&gt;级数&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula/%5Csum_%7Bi=0%7D%5E%7BN%7D%7BA%5E%7Bi%7D%7D%20=%20%5Cfrac%7BA%5E%7BN+1%7D%20-%201%7D%7BA%20-%201%7D%20.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formla/%5Csum_%7Bi=0%7D%5E%7BN%7D%7B2%5E%7Bi%7D%7D%20=%202%5E%7BN+1%7D%20-%201.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula%5Csum_%7Bi=0%7D%5E%7BN%7D%7Bi%7D%20=%20%5Cfrac%7BN%28N%20+%201%29%29%7D%7B2%7D%5Capprox%20%5Cfrac%7BN%5E%7B2%7D%7D%7B2%7D%20.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula%5Csum_%7Bi=1%7D%5E%7BN%7D%7Bi%5E%7B2%7D%7D%20=%20%5Cfrac%7BN%28N+1%29%282n+1%29%7D%7B6%7D%5Capprox%20%5Cfrac%7BN%5E%7B3%7D%7D%7B3%7D%20.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula%5Csum_%7Bi=1%7D%5E%7BN%7D%7Bi%5E%7Bk%7D%7D%20=%20%5Cfrac%7BN%5E%7Bk+1%7D%7D%7B%5Cleft%20%7C%20k+1%20%5Cright%20%7C%7D%20%5C,%5C,%5C,%5C,%20k%5Cneq-1.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formulaH_%7BN%7D=%20%5Csum_%7Bi=1%7D%5E%7BN%7D%7B%5Cfrac%7B1%7D%7Bi%7D%7D%5Capprox%20%5Clog_%7Be%7D%7BN%7D%5Cquad%20%5Cgamma%20%5Capprox%200.57721566.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula%5Csum_%7Bi=1%7D%5E%7BN%7D%7Bf%28N%29%7D=Nf%28N%29.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formula%5Csum_%7Bi=n_%7B0%7D%7D%5E%7BN%7D%7Bf%28i%29%7D=%5Csum_%7Bi=1%7D%5E%7BN%7D%7Bf%28i%29%7D-%5Csum_%7Bi=1%7D%5E%7Bn_%7B0%7D-1%7D%7Bf%28i%29%7D.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;/p&gt;
&lt;h2 id=&quot;u6A21_u8FD0_u7B97&quot;&gt;&lt;a href=&quot;#u6A21_u8FD0_u7B97&quot; class=&quot;headerlink&quot; title=&quot;模运算&quot;&gt;&lt;/a&gt;模运算&lt;/h2&gt;&lt;p&gt;如果N整除A-B，即(A-B)/N为整数，则认为A与B模N同余，记为A≡B(mod N)。例如：11≡7≡3(mod 4)&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/formulaA%5Cequiv%20B%28mod%20N%29%20%5C%5C%20%5CRightarrow%20A+C%5Cequiv%20B+C%28mod%20N%29%20%5C%5C%20%5CRightarrow%20AD%5Cequiv%20BD%28mod%20N%29.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近复习算法和数据结构，记录下一些数学公式，顺便了解下latex。&lt;/p&gt;
&lt;h2 id=&quot;u6307_u6570&quot;&gt;&lt;a href=&quot;#u6307_u6570&quot; class=&quot;headerlink&quot; title=&quot;指数&quot;&gt;&lt;/a&gt;指数&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;h
    
    </summary>
    
      <category term="数学" scheme="http://coderq.github.io/categories/%E6%95%B0%E5%AD%A6/"/>
    
    
      <category term="数学" scheme="http://coderq.github.io/tags/%E6%95%B0%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>node.js在项目中应该放在哪个位置</title>
    <link href="http://coderq.github.io/2016/05/05/how-to-build-fast-api/"/>
    <id>http://coderq.github.io/2016/05/05/how-to-build-fast-api/</id>
    <published>2016-05-05T12:53:57.000Z</published>
    <updated>2016-05-05T13:32:44.000Z</updated>
    
    <content type="html">&lt;p&gt;用了node.js这么长时间，对node.js擅长和不擅长的领域算是比较清晰了。&lt;/p&gt;
&lt;h2 id=&quot;u8FDB_u7A0B_u4E0E_u7EBF_u7A0B&quot;&gt;&lt;a href=&quot;#u8FDB_u7A0B_u4E0E_u7EBF_u7A0B&quot; class=&quot;headerlink&quot; title=&quot;进程与线程&quot;&gt;&lt;/a&gt;进程与线程&lt;/h2&gt;&lt;p&gt;进程是计算机中已运行程序的实体，一个进程可以包含多个线程，多个线程共同某个进程的工作。一个CPU同一时间只能处理某个进程的任务。所有的&lt;em&gt;线程&lt;/em&gt;共享着计算机的内存，没有做任何的隔离。但是，为了保证某些数据的安全，会在内存中使用&lt;code&gt;互斥锁（Mutual exclusion，缩写 Mutex）&lt;/code&gt;及&lt;code&gt;信号量（Semaphore）&lt;/code&gt;。互斥锁允许且只允许同一时间只有一个线程操作共享内存，其它线程必须等待该线程处理完成后再对该内存块进行处理；信号量的逻辑与互斥锁相似，只是同一时间允许N个线程对共享内存进行操作，当名额满了之后其他线程必须等待。&lt;br&gt;这篇&lt;a href=&quot;http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;文章&lt;/a&gt;很好的解释了进程与线程的关系，以及他们对CPU和内存的使用方式。&lt;/p&gt;
&lt;h2 id=&quot;u963B_u585EI/O_u548C_u975E_u963B_u585EI/O&quot;&gt;&lt;a href=&quot;#u963B_u585EI/O_u548C_u975E_u963B_u585EI/O&quot; class=&quot;headerlink&quot; title=&quot;阻塞I/O和非阻塞I/O&quot;&gt;&lt;/a&gt;阻塞I/O和非阻塞I/O&lt;/h2&gt;&lt;p&gt;写程序，操作文件、读写数据库和请求第三方服务等都是常有的事，这些都是I/O，I/O是非常耗时间的。&lt;/p&gt;
&lt;p&gt;当程序采用阻塞I/O的策略时，线程遇到I/O操作就会等待，直到I/O操作结束，再继续执行，例如PHP语言，就是采用这种机制。那么PHP采用这种机制，如果一个请求由于I/O操作导致线程被阻塞，是否会影响其它请求的响应时间呢，答案是不会的，看&lt;code&gt;多线程与单线程&lt;/code&gt;里面的解释。&lt;/p&gt;
&lt;p&gt;当程序采用非阻塞I/O的策略时，线程遇到I/O操作时，会通知另外的线程去处理，然后主线程挂起一个回调函数，并继续执行其他的任务，不会做任何的等待，直到这个I/O操作完成，另外的线程将结果返回给主线程，主线程调用之前挂起的回到函数，继续执行接下来的操作。&lt;/p&gt;
&lt;p&gt;node.js就是采用非阻塞I/O和事件轮询的方式。我们知道Javascript单进程单线程的语言，但是所谓的单线程只是说他执行任务时用的是一个线程，我们称之为主线程，既然有主线程，那就说明肯定还有其他线程，是的，就是任务队列，专门负责处理I/O操作，当node.js的主线程发现了一个异步行为，他会将该任务挂起，将他提交给任务队列去处理，直到任务队列处理完该任务并返回处理结果时，主线程再调用处理该结果的回调函数继续执行。通过这样的方式，主线程不需要等待任何I/O操作，使主线程的资源利用率成倍提升。&lt;/p&gt;
&lt;h2 id=&quot;u5355_u7EBF_u7A0B_u4E0E_u591A_u7EBF_u7A0B&quot;&gt;&lt;a href=&quot;#u5355_u7EBF_u7A0B_u4E0E_u591A_u7EBF_u7A0B&quot; class=&quot;headerlink&quot; title=&quot;单线程与多线程&quot;&gt;&lt;/a&gt;单线程与多线程&lt;/h2&gt;&lt;p&gt;上面的内容中提到，PHP采用了阻塞I/O的方案，该方案会等待I/O操作结束再继续执行接下来的代码。那么这样的方式，如果同时多个请求进来了，由于I/O阻塞的原因会不会出现某个请求执行了很久，导致后面的请求响应慢的问题，答案是不会的。因为PHP采用了多线程的处理方案，当有一个请求进来的时候，PHP就会开启一个线程来处理一个请求，一个请求对应一个线程，那么一个请求所出现的问题是不会影响到另一个请求的（CPU和内存富足的情况下）。PHP的这种方案使得各线程之间相对安全，不会互相影响，但是弊端也是明显的，当I/O出现时，PHP始终处于等待状态，这导致CPU的利用率低，并且，一个请求进来就创建一个线程，这对内存的要求较高，因此，在高并发的情况下，需要横向扩展PHP服务器以满足高并发的需求，很多时候都是因为线程过多导致内存不足的问题。&lt;/p&gt;
&lt;p&gt;node.js的非阻塞I/O和事件轮询机制很好的优化了这个问题，通过非阻塞I/O提高了CPU的利用率，并且单个线程对内存的需求肯定比PHP少得多，因此node.js更能扛得住高并发。但任何事情都是双面的，有优点就必然有确定，单线程的javascript，如果某个请求出现了异常，就会导致整个进程不用了，当然，我们有解决方案可以让程序在出现异常的情况下自动重启。还有就是如果你在node.js的主线程执行了高CPU运算的操作，那将是灾难。因为在主线程中，除了I/O是异步的，其他运算都是同步的，一个高CPU运算的操作会导致后续的请求全部被卡住。&lt;/p&gt;
&lt;p&gt;因此，node.js虽然被很多人追捧，但是，如果用的不好，还不如写PHP。&lt;em&gt;node.js更适合做任务的分发者而不是执行者！！！&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xqex1.com1.z0.glb.clouddn.com/framework.png&quot; alt=&quot;架构图&quot; title=&quot;架构图&quot;&gt;&lt;/p&gt;
&lt;p&gt;如果我有一个团队，我更愿意这样去搭建一个后端的服务，node.js不太适合出现在数据层，除非真的只是增删查改而没有其他高耗CPU的操作，node.js更适合作为前端的路由去分发请求，他自身不应该出现过多的CPU操作，如果有，请用fork。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;用了node.js这么长时间，对node.js擅长和不擅长的领域算是比较清晰了。&lt;/p&gt;
&lt;h2 id=&quot;u8FDB_u7A0B_u4E0E_u7EBF_u7A0B&quot;&gt;&lt;a href=&quot;#u8FDB_u7A0B_u4E0E_u7EBF_u7A0B&quot; class=&quot;heade
    
    </summary>
    
      <category term="node.js" scheme="http://coderq.github.io/categories/node-js/"/>
    
    
      <category term="node.js" scheme="http://coderq.github.io/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>通过RSA实现SSH免密登录及mosh替换SSH避免断网断线</title>
    <link href="http://coderq.github.io/2016/05/05/ssh-rsa-mosh/"/>
    <id>http://coderq.github.io/2016/05/05/ssh-rsa-mosh/</id>
    <published>2016-05-04T17:27:51.000Z</published>
    <updated>2016-06-13T06:02:42.000Z</updated>
    
    <content type="html">&lt;p&gt;1.SSH是我们常用的连接服务器的工具，频繁的输入账号密码会很麻烦，通过RSA的公私钥机制，可以实现免密登录。方法是将客户端的公钥放到服务器的~/.ssh目录下，并重命名为&lt;code&gt;authorized_keys&lt;/code&gt;；&lt;/p&gt;
&lt;p&gt;2.SSH工具采用的是TCP连接，在网络断开的情况下SSH就会自动断开，于是终端会变成假死状态，必须关了重开，很麻烦。mosh使用UDP连接，不用担心断网重连的问题。mosh的使用，必须拥有服务端，即除了客户端需要安装mosh外，服务端也需要装mosh，之后通过命令&lt;code&gt;mosh root@&amp;lt;your host&amp;gt;&lt;/code&gt;即可完成连接。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;1.SSH是我们常用的连接服务器的工具，频繁的输入账号密码会很麻烦，通过RSA的公私钥机制，可以实现免密登录。方法是将客户端的公钥放到服务器的~/.ssh目录下，并重命名为&lt;code&gt;authorized_keys&lt;/code&gt;；&lt;/p&gt;
&lt;p&gt;2.SSH工具采用的是TCP
    
    </summary>
    
      <category term="ssh" scheme="http://coderq.github.io/categories/ssh/"/>
    
    
      <category term="mosh" scheme="http://coderq.github.io/tags/mosh/"/>
    
      <category term="rsa" scheme="http://coderq.github.io/tags/rsa/"/>
    
      <category term="ssh" scheme="http://coderq.github.io/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>数据结构的一些基本概念</title>
    <link href="http://coderq.github.io/2016/05/04/data-structure/"/>
    <id>http://coderq.github.io/2016/05/04/data-structure/</id>
    <published>2016-05-04T00:07:48.000Z</published>
    <updated>2016-06-20T04:55:59.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;u62BD_u8C61_u6570_u636E_u7C7B_u578B&quot;&gt;&lt;a href=&quot;#u62BD_u8C61_u6570_u636E_u7C7B_u578B&quot; class=&quot;headerlink&quot; title=&quot;抽象数据类型&quot;&gt;&lt;/a&gt;抽象数据类型&lt;/h2&gt;&lt;p&gt;抽象数据类型(abstract data type, ADT)是一些操作的集合。对诸如表、集合、图和它们的操作一起可以看作是抽象数据类型。&lt;/p&gt;
&lt;h2 id=&quot;u8868&quot;&gt;&lt;a href=&quot;#u8868&quot; class=&quot;headerlink&quot; title=&quot;表&quot;&gt;&lt;/a&gt;表&lt;/h2&gt;&lt;h3 id=&quot;u6570_u7EC4&quot;&gt;&lt;a href=&quot;#u6570_u7EC4&quot; class=&quot;headerlink&quot; title=&quot;数组&quot;&gt;&lt;/a&gt;数组&lt;/h3&gt;&lt;p&gt;使用数组实现表结构时，在元素的增删比较麻烦，例如在0位增加一个元素，需要将所有元素后移一位，删除一个元素，需要讲所有元素前移一位，时间复杂度位O(N)。&lt;/p&gt;
&lt;h3 id=&quot;u94FE_u8868&quot;&gt;&lt;a href=&quot;#u94FE_u8868&quot; class=&quot;headerlink&quot; title=&quot;链表&quot;&gt;&lt;/a&gt;链表&lt;/h3&gt;&lt;p&gt;链表实现表结构时，增删操作的时间复杂度位O(1)。假设链表有5个节点，当需要在2和3之间增加一个节点时，只要创建一个新的节点空间，让2的next指针指向这个新创建的节点，再让新创建节点的指针指向3这个节点，则新增操作完成。删除某个节点时，讲节点的前一个节点的next指针指向当前节点的下个节点，并删除当前节点即可。&lt;/p&gt;
&lt;h3 id=&quot;u53CC_u5411_u94FE_u8868&quot;&gt;&lt;a href=&quot;#u53CC_u5411_u94FE_u8868&quot; class=&quot;headerlink&quot; title=&quot;双向链表&quot;&gt;&lt;/a&gt;双向链表&lt;/h3&gt;&lt;p&gt;双向链表与链表的差别在于，双向链表出了有next指针指向下一个元素，还有prev指针指向前一个元素，形成了双向链。&lt;/p&gt;
&lt;h3 id=&quot;u5FAA_u73AF_u94FE_u8868&quot;&gt;&lt;a href=&quot;#u5FAA_u73AF_u94FE_u8868&quot; class=&quot;headerlink&quot; title=&quot;循环链表&quot;&gt;&lt;/a&gt;循环链表&lt;/h3&gt;&lt;p&gt;循环链表的特别在于，最后一个元素的next指向第一个元素，而第一个元素的prev指向了最后一个元素。在双向链表中，这两个指针指向的都是null。&lt;/p&gt;
&lt;h2 id=&quot;u6808&quot;&gt;&lt;a href=&quot;#u6808&quot; class=&quot;headerlink&quot; title=&quot;栈&quot;&gt;&lt;/a&gt;栈&lt;/h2&gt;&lt;h2 id=&quot;u961F_u5217&quot;&gt;&lt;a href=&quot;#u961F_u5217&quot; class=&quot;headerlink&quot; title=&quot;队列&quot;&gt;&lt;/a&gt;队列&lt;/h2&gt;</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u62BD_u8C61_u6570_u636E_u7C7B_u578B&quot;&gt;&lt;a href=&quot;#u62BD_u8C61_u6570_u636E_u7C7B_u578B&quot; class=&quot;headerlink&quot; title=&quot;抽象数据类型&quot;&gt;&lt;/a&gt;抽象数据类型&lt;/h2
    
    </summary>
    
      <category term="数据结构" scheme="http://coderq.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
      <category term="数据结构" scheme="http://coderq.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>javascript实现快速排序</title>
    <link href="http://coderq.github.io/2016/05/03/javascript-fast-sort/"/>
    <id>http://coderq.github.io/2016/05/03/javascript-fast-sort/</id>
    <published>2016-05-03T15:21:35.000Z</published>
    <updated>2016-05-03T15:22:16.000Z</updated>
    
    <content type="html">&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;pi&quot;&gt;&#39;use strict&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/* jshint node: true */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; len = &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; ary = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Array&lt;/span&gt;(len).fill(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;).map(() =&amp;gt; &lt;span class=&quot;built_in&quot;&gt;Math&lt;/span&gt;.floor(&lt;span class=&quot;built_in&quot;&gt;Math&lt;/span&gt;.random() * len));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; ret = (&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;fastsort&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;ary&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ary.length &amp;lt;= &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ary;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; k = &lt;span class=&quot;built_in&quot;&gt;Math&lt;/span&gt;.floor(&lt;span class=&quot;built_in&quot;&gt;Math&lt;/span&gt;.random() * ary.length);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; l_ary = ary.filter((item, index) =&amp;gt; (index != k) &amp;amp;&amp;amp; (item &amp;lt; ary[k]));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; r_ary = ary.filter((item, index) =&amp;gt; (index != k) &amp;amp;&amp;amp; (item &amp;gt;= ary[k]));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; fastsort(l_ary).concat(ary[k]).concat(fastsort(r_ary));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;(ary));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(ary);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(ret);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span 
    
    </summary>
    
      <category term="javascript" scheme="http://coderq.github.io/categories/javascript/"/>
    
    
      <category term="javascript" scheme="http://coderq.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>C语言中整型的二进制表示</title>
    <link href="http://coderq.github.io/2016/05/02/c-binary/"/>
    <id>http://coderq.github.io/2016/05/02/c-binary/</id>
    <published>2016-05-02T13:09:23.000Z</published>
    <updated>2016-05-02T14:34:17.000Z</updated>
    
    <content type="html">&lt;p&gt;C语言中，正数的原码、反码和补码都是一样的，但是负数的的表示是其补码，补码是反码+1。&lt;/p&gt;
&lt;p&gt;int类型是4字节，表示-2^31 ~ 2^31-1&lt;/p&gt;
&lt;p&gt;我们设定一个变量60，看它各运算后的结果&lt;/p&gt;
&lt;p&gt;60的二进制表示为00000000 00000000 00000000 00111100&lt;/p&gt;
&lt;p&gt;~60，我们对60取反，得到这样的二进制11111111 11111111 11111111 11000011&lt;/p&gt;
&lt;p&gt;首位的比特位是1，表示这是一个负数，C语言中的负数是补码表示，我们需要讲补码转为原码才知道该二进制在C语言中表示什么编码&lt;/p&gt;
&lt;p&gt;补码是反码+1，因此反码为11111111 11111111 11111111 11000010&lt;/p&gt;
&lt;p&gt;原码为反码除符号位外其他位求反，因此，原码为10000000 00000000 00000000 00111101，即-61&lt;/p&gt;
&lt;p&gt;因此~60 == -61&lt;/p&gt;
&lt;p&gt;60 &amp;lt;&amp;lt; 2，我们对60左移两位，得到这样的二进制00000000 00000000 00000000 11110000&lt;/p&gt;
&lt;p&gt;这是一个符号位为0的二进制，表示的结果为正数，240&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;C语言中，正数的原码、反码和补码都是一样的，但是负数的的表示是其补码，补码是反码+1。&lt;/p&gt;
&lt;p&gt;int类型是4字节，表示-2^31 ~ 2^31-1&lt;/p&gt;
&lt;p&gt;我们设定一个变量60，看它各运算后的结果&lt;/p&gt;
&lt;p&gt;60的二进制表示为00000000 000000
    
    </summary>
    
      <category term="C" scheme="http://coderq.github.io/categories/C/"/>
    
    
      <category term="C" scheme="http://coderq.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>git踩坑记录</title>
    <link href="http://coderq.github.io/2016/04/28/git/"/>
    <id>http://coderq.github.io/2016/04/28/git/</id>
    <published>2016-04-28T09:01:58.000Z</published>
    <updated>2016-05-12T05:03:40.000Z</updated>
    
    <content type="html">&lt;p&gt;我在我的机器上能够通过配置ssh key访问github管理代码，但是在公司的服务器上不管怎么配置都不行，实在搞不懂了，然后同事送我这行代码，只要输一次账号密码，然后敲上这句，搞定，下次不用再输入账号密码了。&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git config credential.helper store&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;修改了了一堆文件后，偶尔会出现某个文件只是为了调试而加了console之类的代码，这时候你想把他还原&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git checkout &amp;#60;file name&amp;#62;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;我在我的机器上能够通过配置ssh key访问github管理代码，但是在公司的服务器上不管怎么配置都不行，实在搞不懂了，然后同事送我这行代码，只要输一次账号密码，然后敲上这句，搞定，下次不用再输入账号密码了。&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;ta
    
    </summary>
    
      <category term="git" scheme="http://coderq.github.io/categories/git/"/>
    
    
      <category term="git" scheme="http://coderq.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Javascript异步调用顺序执行方法</title>
    <link href="http://coderq.github.io/2016/04/25/javascript-async-order/"/>
    <id>http://coderq.github.io/2016/04/25/javascript-async-order/</id>
    <published>2016-04-24T17:45:17.000Z</published>
    <updated>2016-04-24T17:58:49.000Z</updated>
    
    <content type="html">&lt;p&gt;在使用异步回调的时候，我们经常会接住async等模块的帮助，但是有时候我们仅仅只需要一个异步调用同步执行的方法，似乎没必要使用那么多的代码，那么，异步调用顺序执行的方法如果自己写要怎么写呢？&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; fns = [].slice.call(&lt;span class=&quot;built_in&quot;&gt;arguments&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    fns.map(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;fn, i, fns&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        fns[i] = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        	&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; args = [].slice.call(&lt;span class=&quot;built_in&quot;&gt;arguments&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            fn.apply(&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;, i + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; === fns.length ? args : [fns[i + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]].concat(args));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    fns[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].call(&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;next&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    setTimeout(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;method 1&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        next(&lt;span class=&quot;string&quot;&gt;&#39;method 1&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;complete!&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;, &lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;next, a, b&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    setTimeout(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(a, b);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;method 2&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        next(&lt;span class=&quot;string&quot;&gt;&#39;method 2&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;complete!&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;, &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;a, b&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(a, b);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;end&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// method 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// method 1 complete!&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// method 2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// method 2 complete!&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;一开始我一直处理不好next和data混合在一起的处理方法，直到我看到了一段类似的代码才醒悟。当前函数执行完之后调用next函数时，只有实际数据部分，但是下一个函数的定义却有一个next的第一参数，因此，我们需要讲原有的函数做替换，让他可以正常的接受当前函数传递过来的参数，并且执行的时候加上next参数。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在使用异步回调的时候，我们经常会接住async等模块的帮助，但是有时候我们仅仅只需要一个异步调用同步执行的方法，似乎没必要使用那么多的代码，那么，异步调用顺序执行的方法如果自己写要怎么写呢？&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;
    
    </summary>
    
      <category term="javascript" scheme="http://coderq.github.io/categories/javascript/"/>
    
    
      <category term="javascript" scheme="http://coderq.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>mongoose中document的版本控制（__v）</title>
    <link href="http://coderq.github.io/2016/04/22/mongoose-version/"/>
    <id>http://coderq.github.io/2016/04/22/mongoose-version/</id>
    <published>2016-04-22T03:26:47.000Z</published>
    <updated>2016-04-22T03:28:23.000Z</updated>
    
    <content type="html">&lt;p&gt;技术债，待还。。。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;技术债，待还。。。&lt;/p&gt;

    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>我是如何构建我的后端服务器的</title>
    <link href="http://coderq.github.io/2016/04/20/backend-build/"/>
    <id>http://coderq.github.io/2016/04/20/backend-build/</id>
    <published>2016-04-20T00:06:21.000Z</published>
    <updated>2016-04-22T00:28:01.000Z</updated>
    
    <content type="html">&lt;p&gt;最近有空的时候一直在整理自己的后端代码，希望整理出一套较为通用的代码，可以运用到大多数的项目中去。现在的项目基本都是前后端分离的，后端只负责提供restful api接口，根据不同的项目，和前端会有不同的集成方式，例如app的后端，基本就是一个独立的项目，我个人的博客后端，我会考虑使用nginx做一个转发，当接收到&lt;code&gt;/&lt;/code&gt;到请求时，转发给前端页面处理；当接受到&lt;code&gt;/service&lt;/code&gt;请求时，转发给后端处理，这些请求基本上都是前端的ajax请求，避免了跨域的麻烦。后端的代码中我们只要用一个简单的use方法做转发可以将&lt;code&gt;/service&lt;/code&gt;的请求转回原地址了。&lt;/p&gt;
&lt;p&gt;我的项目目录：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;controller // &amp;#23384;&amp;#20648;&amp;#25511;&amp;#21046;&amp;#22120;&amp;#30340;&amp;#25991;&amp;#20214;&amp;#22841;&amp;#10;library // &amp;#23384;&amp;#20648;&amp;#36890;&amp;#29992;&amp;#20195;&amp;#30721;&amp;#30340;&amp;#25991;&amp;#20214;&amp;#22841;&amp;#10;- error.js // &amp;#36890;&amp;#29992;&amp;#38169;&amp;#35823;&amp;#23450;&amp;#20041;&amp;#10;- helper.js // &amp;#31995;&amp;#32479;&amp;#32423;&amp;#36890;&amp;#29992;&amp;#20989;&amp;#25968;&amp;#23450;&amp;#20041;&amp;#65292;&amp;#20363;&amp;#22914;jwt&amp;#20196;&amp;#29260;&amp;#29983;&amp;#20135;&amp;#21644;&amp;#26657;&amp;#39564;&amp;#10;- middleware.js // &amp;#20013;&amp;#38388;&amp;#20214;&amp;#23450;&amp;#20041;&amp;#10;- util.js // &amp;#24120;&amp;#35268;&amp;#36890;&amp;#29992;&amp;#20989;&amp;#25968;&amp;#23450;&amp;#20041;&amp;#65292;&amp;#19968;&amp;#33324;&amp;#20197;lodash&amp;#25110;&amp;#31995;&amp;#32479;&amp;#20869;&amp;#32622;&amp;#30340;util&amp;#27169;&amp;#22359;&amp;#20026;&amp;#22522;&amp;#30784;&amp;#65292;md5&amp;#31561;&amp;#33258;&amp;#24049;&amp;#24120;&amp;#29992;&amp;#30340;&amp;#26041;&amp;#27861;&amp;#10;model // &amp;#23384;&amp;#20648;mysql&amp;#12289;mongo&amp;#21450;redis&amp;#25968;&amp;#25454;&amp;#27169;&amp;#22411;&amp;#30340;&amp;#25991;&amp;#20214;&amp;#22841;&amp;#10;- mysql // mysql&amp;#10;- mongo // mongodb&amp;#10;- redis // redis&amp;#10;- index.js&amp;#10;node_modules // node.js&amp;#30340;&amp;#27169;&amp;#22359;&amp;#10;router // &amp;#31995;&amp;#32479;&amp;#36335;&amp;#30001;&amp;#10;- v1.js // &amp;#29256;&amp;#26412;1&amp;#30340;&amp;#36335;&amp;#30001;&amp;#10;- v1_1.js // &amp;#29256;&amp;#26412;1.1&amp;#30340;&amp;#36335;&amp;#30001;&amp;#10;- index.js // &amp;#36890;&amp;#36807;use&amp;#26041;&amp;#27861;&amp;#35843;&amp;#29992;&amp;#21508;&amp;#29256;&amp;#26412;&amp;#36335;&amp;#30001;&amp;#10;service // controller&amp;#21644;model&amp;#20043;&amp;#38388;&amp;#30340;&amp;#19994;&amp;#21153;&amp;#36923;&amp;#36753;&amp;#20195;&amp;#30721;&amp;#10;test // &amp;#21333;&amp;#20803;&amp;#27979;&amp;#35797;&amp;#25991;&amp;#20214;&amp;#22841;&amp;#10;.gitignore&amp;#10;app.js // &amp;#21551;&amp;#21160;&amp;#25991;&amp;#20214;&amp;#10;config.js // &amp;#37197;&amp;#32622;&amp;#25991;&amp;#20214;&amp;#10;package.json // &amp;#27169;&amp;#22359;&amp;#37197;&amp;#32622;&amp;#25991;&amp;#20214;&amp;#10;readme.md&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;所有的请求都会经过路由再到达控制器，路由是所有代码内容的第一关，特别是在app项目里面，url一旦发布就难以修改（客户端也可以通过默写热修复的方法处理），url地址的设计好坏对于项目维护很重要。我在定义路由的时候，会有一个总的index.js文件，app.js只要引入这个文件即可，项目就可以访问到所有版本的api。&lt;/p&gt;
&lt;p&gt;index.js&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;pi&quot;&gt;&#39;use strict&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/* jshint node: true */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; Mdl = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../library/middleware&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; Ctr = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../controller&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; Router = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;koa-router&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; v_1 = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./v1&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; v_1_1 = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./v1_1&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; v_admin = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./admin&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; router = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Router();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// restful api v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;router.use(&lt;span class=&quot;string&quot;&gt;&#39;/1&#39;&lt;/span&gt;, v_1.routes(), v_1.allowedMethods());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// restful api v1.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rotuer.use(&lt;span class=&quot;string&quot;&gt;&#39;/1.1&#39;&lt;/span&gt;, v_1_1.routes(), v_1_1.allowedMethods());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// manage api&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;router.use(&lt;span class=&quot;string&quot;&gt;&#39;/admin&#39;&lt;/span&gt;, v_admin.routes(), v_admin.allowedMethods());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;router.all(&lt;span class=&quot;string&quot;&gt;&#39;*&#39;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;*(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.status = &lt;span class=&quot;number&quot;&gt;404&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = router;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;v1.js&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;pi&quot;&gt;&#39;use strict&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/* jshint node: true */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; Ctr = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../controller&#39;&lt;/span&gt;).v1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; Router = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;koa-router&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; v1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Router();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 增加用户&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;v1.post(&lt;span class=&quot;string&quot;&gt;&#39;/user&#39;&lt;/span&gt;, Ctr.User.create);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 删除用户&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;v1.delete(&lt;span class=&quot;string&quot;&gt;&#39;/user/:user_id&#39;&lt;/span&gt;, Ctr.User.delete);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 查询用户信息&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;v1.get(&lt;span class=&quot;string&quot;&gt;&#39;/user/:user_id&#39;&lt;/span&gt;, Ctr.User.read);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;v1.get(&lt;span class=&quot;string&quot;&gt;&#39;/user&#39;&lt;/span&gt;, Ctr.User.read);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 修改用户信息&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;v1.put(&lt;span class=&quot;string&quot;&gt;&#39;/user/:user_id&#39;&lt;/span&gt;, Ctr.User.update);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在我的&lt;code&gt;controller&lt;/code&gt; &lt;code&gt;service&lt;/code&gt; &lt;code&gt;model&lt;/code&gt;三个文件夹下，都会有一个&lt;code&gt;index.js&lt;/code&gt;的文件，&lt;code&gt;controller&lt;/code&gt;会被路由引入，&lt;code&gt;controller&lt;/code&gt;又会引入&lt;code&gt;service&lt;/code&gt;，&lt;code&gt;service&lt;/code&gt;又引入&lt;code&gt;model&lt;/code&gt;，最终到达数据库。我比较习惯用一个单独的大写字母来标示一些特殊的集合。&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; U = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../library/util&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; H = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../library/helper&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; S = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../library/service&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; M = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../library/model&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;一开始用这种方法的时候，总会担心别人的批评，因为这种看不出是什么鬼的定义很容易被喷，有点过不去心里的坎，不过后来想想，规则就是人定的，为什么一定要遵守别人的规则，自己觉得好久即可。以前做PHP用think PHP框架也有类似的语法。用一个字母表示一个集合，确实是蛮实用的。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;service&lt;/code&gt;作为服务层，承载着所有增删改查的业务逻辑处理，虽然有模型层把控数据格式，但是模型层很多时候只会返回诸如&lt;code&gt;Validation error&lt;/code&gt;之类的单一错误提示，这样的提示很难判定是哪个地方出了异常，所以在数据进入模型层之前，我会对参数做断言判断，而断言的异常情况，会统一定义在&lt;code&gt;library/error.js&lt;/code&gt;文件里。&lt;/p&gt;
&lt;p&gt;登录验证的服务层&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;exports.verify = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;*(&lt;span class=&quot;params&quot;&gt;account, password&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  assert(H.isAccount(account), &lt;span class=&quot;string&quot;&gt;&#39;ACCOUNT_INVALID&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  assert(U.isPassword(password), &lt;span class=&quot;string&quot;&gt;&#39;PASSWORD_INVALID&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; rs = &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; M.Mysql.User.findOne(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    where: &amp;#123; $or: [&amp;#123; mobile: account &amp;#125;, &amp;#123; email: account &amp;#125;] &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    include: [&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      model: M.Mysql.UserProfile,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      through: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        attributes: [&lt;span class=&quot;string&quot;&gt;&#39;gender&#39;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  assert(rs, &lt;span class=&quot;string&quot;&gt;&#39;USER_GONE&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  assert(rs.password == H.generatePassword(password, rs.password_salt), &lt;span class=&quot;string&quot;&gt;&#39;PASSWORD_ERROR&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; access_token = &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; H.signToken(U.extend(rs, &amp;#123; password_salt: &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt; &amp;#125;, U.extend.RN));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; refresh_token = &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; H.signToken(&amp;#123; user_id: rs._id &amp;#125;, refresh_token_expires);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &amp;#123; access_token: access_token, refresh_token: refresh_token &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;error.js&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;pi&quot;&gt;&#39;use strict&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/* jshint node: true */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exports.ACCOUNT_INVALID = &amp;#123;message: &lt;span class=&quot;string&quot;&gt;&#39;账号无效&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exports.PASSWORD_INVALID = &amp;#123;message: &lt;span class=&quot;string&quot;&gt;&#39;密码无效&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exports.PASSWORD_ERROR = &amp;#123;message: &lt;span class=&quot;string&quot;&gt;&#39;密码错误&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exports.USER_GONE = &amp;#123;message: &lt;span class=&quot;string&quot;&gt;&#39;用户不存在&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;410&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exports.PARAM_INVALID = &amp;#123;message: &lt;span class=&quot;string&quot;&gt;&#39;参数错误&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exports.MOBILE_EXISTS = &amp;#123;message: &lt;span class=&quot;string&quot;&gt;&#39;手机号码已存在&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;409&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exports.EMAIL_EXISTS = &amp;#123;message: &lt;span class=&quot;string&quot;&gt;&#39;电子邮箱已存在&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;409&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exports.OBJECT_ID_INVALID = &amp;#123;message: &lt;span class=&quot;string&quot;&gt;&#39;无效的查询ID&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exports.EMAIL_INVALID = &amp;#123;message: &lt;span class=&quot;string&quot;&gt;&#39;电子邮箱格式错误&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exports.MOBILE_INVALID = &amp;#123;message: &lt;span class=&quot;string&quot;&gt;&#39;手机号码格式错误&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exports.BOOK_GONE = &amp;#123;message: &lt;span class=&quot;string&quot;&gt;&#39;书籍不存在&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;有了&lt;code&gt;assert&lt;/code&gt;，于是代码里必然要出现&lt;code&gt;try {} catch(e) {}&lt;/code&gt;的代码。每个接口都写一遍&lt;code&gt;try catch&lt;/code&gt;会很麻烦，既然error可以统一由error.js定义，那么统一处理也是可以的&lt;/p&gt;
&lt;p&gt;登录验证的controller&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;exports.verify = H.f(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;*(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; account = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.request.body.account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; password = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.request.body.password;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; ret = &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; S.Auth.verify.call(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, account, password);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.send(&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;, ret);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;正常来讲，verify这个方法只要返回一个&lt;code&gt;Generator function&lt;/code&gt;即可，为了把&lt;code&gt;try catch&lt;/code&gt;的代码提取出来，我包多了一层函数用来处理异常。这个函数定义在我的&lt;code&gt;library/helper.js&lt;/code&gt;文件里面&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;exports.f = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;func, error&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	error = error || &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;*(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; func.call(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; obj = error[e.message] || E[e.message] || &amp;#123;message: C.debug ? e.stack : &lt;span class=&quot;string&quot;&gt;&#39;未知异常&#39;&lt;/span&gt;, code: &lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; obj.message === &lt;span class=&quot;string&quot;&gt;&#39;string&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				obj.message = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					code: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					message: obj.message&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.send(obj.code, obj.message);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;函数的名字主要是为了简短，又想不出太好的命名，就直接给了个&lt;code&gt;f&lt;/code&gt;，函数的两个参数，第一个就是传入进来的&lt;code&gt;generator function&lt;/code&gt;，第二个是自定义的错误释义，因为有时候我们需要返回的错误解释也许不是error.js里面定义的那个，或者说有时候同样是401的状态码，但是可能是不同情况导致的，例如有可能是令牌过期，也有可能是用户修改了密码，要求重新登录，于是你必须给出不同的释义。&lt;/p&gt;
&lt;p&gt;模型层基本用的都是orm框架，较好的把控了数据问题，关系数据都存在mysql数据库，较少的数据存mongo，例如书籍这类树形的数据。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近有空的时候一直在整理自己的后端代码，希望整理出一套较为通用的代码，可以运用到大多数的项目中去。现在的项目基本都是前后端分离的，后端只负责提供restful api接口，根据不同的项目，和前端会有不同的集成方式，例如app的后端，基本就是一个独立的项目，我个人的博客后端，
    
    </summary>
    
      <category term="node.js" scheme="http://coderq.github.io/categories/node-js/"/>
    
    
      <category term="node.js" scheme="http://coderq.github.io/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>自己平时使用过的一些mongodb命令记录</title>
    <link href="http://coderq.github.io/2016/04/18/mongodb-command/"/>
    <id>http://coderq.github.io/2016/04/18/mongodb-command/</id>
    <published>2016-04-18T09:26:52.000Z</published>
    <updated>2016-05-19T09:24:15.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;u6839_u636E_u65E5_u671F_u7EDF_u8BA1_u51FA_u67D0_u4E9B_u624B_u673A_u53F7_u8BB0_u5F55_u6570&quot;&gt;&lt;a href=&quot;#u6839_u636E_u65E5_u671F_u7EDF_u8BA1_u51FA_u67D0_u4E9B_u624B_u673A_u53F7_u8BB0_u5F55_u6570&quot; class=&quot;headerlink&quot; title=&quot;根据日期统计出某些手机号记录数&quot;&gt;&lt;/a&gt;根据日期统计出某些手机号记录数&lt;/h2&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; data = db.spinetmp.aggregate([&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;$match: &amp;#123;status: &lt;span class=&quot;string&quot;&gt;&#39;visable&#39;&lt;/span&gt;, checkuserid: &amp;#123;$&lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;: [&lt;span class=&quot;string&quot;&gt;&#39;156****5285&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;156****5194&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;137****8875&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;158****1125&#39;&lt;/span&gt;]&amp;#125;&amp;#125;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;$project: &amp;#123;mobile: &lt;span class=&quot;string&quot;&gt;&#39;$checkuserid&#39;&lt;/span&gt;, date: &amp;#123;$dateToString: &amp;#123;format: &lt;span class=&quot;string&quot;&gt;&quot;%Y-%m-%d&quot;&lt;/span&gt;, date: &lt;span class=&quot;string&quot;&gt;&quot;$version&quot;&lt;/span&gt; &amp;#125;&amp;#125;&amp;#125;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;$group: &amp;#123;_id: &amp;#123;mobile: &lt;span class=&quot;string&quot;&gt;&#39;$mobile&#39;&lt;/span&gt;, date: &lt;span class=&quot;string&quot;&gt;&quot;$date&quot;&lt;/span&gt;&amp;#125;, count: &amp;#123;$sum: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;&amp;#125;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;$sort: &amp;#123;&lt;span class=&quot;string&quot;&gt;&#39;_id.mobile&#39;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;_id.date&#39;&lt;/span&gt;: -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 将数据转为csv格式&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;data.map(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;item&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; item._id.mobile + &lt;span class=&quot;string&quot;&gt;&#39;,&#39;&lt;/span&gt; + item._id.date + &lt;span class=&quot;string&quot;&gt;&#39;,&#39;&lt;/span&gt; + item.count;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;).join(&lt;span class=&quot;string&quot;&gt;&quot;\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;u5012_u51FA_u7528_u6237_u4E66_u5355_u7684_u63CF_u8FF0_u548C_u4E66_u7684_u63A8_u8350_u8BED&quot;&gt;&lt;a href=&quot;#u5012_u51FA_u7528_u6237_u4E66_u5355_u7684_u63CF_u8FF0_u548C_u4E66_u7684_u63A8_u8350_u8BED&quot; class=&quot;headerlink&quot; title=&quot;倒出用户书单的描述和书的推荐语&quot;&gt;&lt;/a&gt;倒出用户书单的描述和书的推荐语&lt;/h2&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; users = db.user.find(&amp;#123;mobile_number: &amp;#123;$&lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;: [&lt;span class=&quot;string&quot;&gt;&#39;156****6041&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;155****4511&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;136****5641&#39;&lt;/span&gt;]&amp;#125;&amp;#125;, &amp;#123;_id: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, mobile_number: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, user_id: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;users.map(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;item&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	item.floors = db.floor.find(&amp;#123;user_id: item.user_id, type: &amp;#123;$exists: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&amp;#125;&amp;#125;, &amp;#123;user_id: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, name: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, desc: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, item_list: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;).toArray();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	item.floors = item.floors.map(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;item&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		item.item_list = item.item_list.map(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;item&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; db.item.findOne(&amp;#123;bid: item&amp;#125;, &amp;#123;bid: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, title: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, remark: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; item;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; item;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;u6839_u636E_u51FA_u7248_u793E_u548C_u4E66_u6392_u51FA_u7528_u6237_u6536_u85CF_u6700_u591A_u7684_u4E66&quot;&gt;&lt;a href=&quot;#u6839_u636E_u51FA_u7248_u793E_u548C_u4E66_u6392_u51FA_u7528_u6237_u6536_u85CF_u6700_u591A_u7684_u4E66&quot; class=&quot;headerlink&quot; title=&quot;根据出版社和书排出用户收藏最多的书&quot;&gt;&lt;/a&gt;根据出版社和书排出用户收藏最多的书&lt;/h2&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;rs.slaveOk();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; data = db.library.aggregate([&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;$group: &amp;#123;_id: &amp;#123;publisher: &lt;span class=&quot;string&quot;&gt;&#39;$publisher&#39;&lt;/span&gt;, bid: &lt;span class=&quot;string&quot;&gt;&#39;$bid&#39;&lt;/span&gt;, title: &lt;span class=&quot;string&quot;&gt;&#39;$title&#39;&lt;/span&gt;&amp;#125;, count: &amp;#123;$sum: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// to csv&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;data&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.toArray()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.sort(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;a, b&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; b.count - a.count;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.map(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;item&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; item._id.publisher + &lt;span class=&quot;string&quot;&gt;&#39;,&#39;&lt;/span&gt; + item._id.bid + &lt;span class=&quot;string&quot;&gt;&#39;,&#39;&lt;/span&gt; + item._id.title + &lt;span class=&quot;string&quot;&gt;&#39;,&#39;&lt;/span&gt; + item.count; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.join(&lt;span class=&quot;string&quot;&gt;&quot;\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;u67E5_u51FA_u6307_u5B9A_u51FA_u7248_u793E_u524D10_u540D_u7684_u4E66_u7C4D&quot;&gt;&lt;a href=&quot;#u67E5_u51FA_u6307_u5B9A_u51FA_u7248_u793E_u524D10_u540D_u7684_u4E66_u7C4D&quot; class=&quot;headerlink&quot; title=&quot;查出指定出版社前10名的书籍&quot;&gt;&lt;/a&gt;查出指定出版社前10名的书籍&lt;/h2&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;rs.slaveOk();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; publishers = [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&#39;人民文学出版社&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&#39;上海译文出版社&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&#39;中华书局&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&#39;中信出版社&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&#39;商务印书馆&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&#39;生活·读书·新知三联书店&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&#39;广西师范大学出版社&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&#39;译林出版社&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&#39;新星出版社&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;string&quot;&gt;&#39;南海出版公司&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; data = db.library.aggregate([&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;$match: &amp;#123;publisher: &amp;#123;$&lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;: publishers&amp;#125;&amp;#125;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;$group: &amp;#123;_id: &amp;#123;publisher: &lt;span class=&quot;string&quot;&gt;&#39;$publisher&#39;&lt;/span&gt;, title: &lt;span class=&quot;string&quot;&gt;&#39;$title&#39;&lt;/span&gt;&amp;#125;, count: &amp;#123;$sum: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//findIndex是es6的函数，自己写。。。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; findIndex = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;fn&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, r;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.length &amp;gt; i &amp;amp;&amp;amp; !(r = fn(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;[i], i, &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;))) i++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; r ? i : -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// to csv&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;data&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 对象数组化&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.toArray()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 按出版社归类排序&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.sort(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;a, b&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (publishers.indexOf(a._id.publisher) - publishers.indexOf(b._id.publisher)) || (b.count - a.count);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 过滤出前10的书籍，这里可以用另一个数组对象来存储数据，减少运算步骤。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.filter(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;item, index, ary&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; index &amp;lt; (findIndex.call(ary, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;data&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; item._id.publisher === data._id.publisher;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;) + &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 格式化&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.map(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;item&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; item._id.publisher + &lt;span class=&quot;string&quot;&gt;&#39;,&#39;&lt;/span&gt; + item._id.title + &lt;span class=&quot;string&quot;&gt;&#39;,&#39;&lt;/span&gt; + item.count; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// toString&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.join(&lt;span class=&quot;string&quot;&gt;&quot;\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;ifNull_u7684_u4F7F_u7528&quot;&gt;&lt;a href=&quot;#ifNull_u7684_u4F7F_u7528&quot; class=&quot;headerlink&quot; title=&quot;ifNull的使用&quot;&gt;&lt;/a&gt;ifNull的使用&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;db.library.aggregate([&amp;#10;&amp;#9;&amp;#123;$match: &amp;#123;user_id: &amp;#39;763532fec962ca3f5c96cd024860a43a&amp;#39;&amp;#125;&amp;#125;,&amp;#10;&amp;#9;&amp;#123;$project: &amp;#123;read_status: &amp;#123;$ifNull: [&amp;#34;$read_status&amp;#34;, &amp;#34;unread&amp;#34;]&amp;#125;&amp;#125;&amp;#125;,&amp;#10;&amp;#9;&amp;#123;$group: &amp;#123;_id: &amp;#39;$read_status&amp;#39;, total: &amp;#123;$sum: 1&amp;#125;&amp;#125;&amp;#125;&amp;#10;]);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u6839_u636E_u65E5_u671F_u7EDF_u8BA1_u51FA_u67D0_u4E9B_u624B_u673A_u53F7_u8BB0_u5F55_u6570&quot;&gt;&lt;a href=&quot;#u6839_u636E_u65E5_u671F_u7EDF_u
    
    </summary>
    
      <category term="mongodb" scheme="http://coderq.github.io/categories/mongodb/"/>
    
    
      <category term="mongodb" scheme="http://coderq.github.io/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>javascript的一些常用技能</title>
    <link href="http://coderq.github.io/2016/04/13/javascript-skill/"/>
    <id>http://coderq.github.io/2016/04/13/javascript-skill/</id>
    <published>2016-04-12T23:33:29.000Z</published>
    <updated>2016-06-20T04:55:59.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;u53CD_u8F6C_u4E00_u4E2A_u5B57_u7B26_u4E32&quot;&gt;&lt;a href=&quot;#u53CD_u8F6C_u4E00_u4E2A_u5B57_u7B26_u4E32&quot; class=&quot;headerlink&quot; title=&quot;反转一个字符串&quot;&gt;&lt;/a&gt;反转一个字符串&lt;/h2&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&#39;123456789&#39;&lt;/span&gt;.split(&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;).revert().join(&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// &#39;987654321&#39;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;u53BB_u91CD&quot;&gt;&lt;a href=&quot;#u53BB_u91CD&quot; class=&quot;headerlink&quot; title=&quot;去重&quot;&gt;&lt;/a&gt;去重&lt;/h2&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&#39;11122213434&#39;&lt;/span&gt;.split(&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;).filter((item, index, ary) =&amp;gt; index == ary.indexOf(item)).join(&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// &#39;1234&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;u591A_u7EF4_u6570_u7EC4-_26gt_3B_u5B57_u7B26_u4E32&quot;&gt;&lt;a href=&quot;#u591A_u7EF4_u6570_u7EC4-_26gt_3B_u5B57_u7B26_u4E32&quot; class=&quot;headerlink&quot; title=&quot;多维数组-&amp;gt;字符串&quot;&gt;&lt;/a&gt;多维数组-&amp;gt;字符串&lt;/h2&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[[[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;], &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;], [&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;], &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;].join(); &lt;span class=&quot;comment&quot;&gt;// &#39;1,2,3,4&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;u8FD4_u56DE_u968F_u673A_u5143_u7D20&quot;&gt;&lt;a href=&quot;#u8FD4_u56DE_u968F_u673A_u5143_u7D20&quot; class=&quot;headerlink&quot; title=&quot;返回随机元素&quot;&gt;&lt;/a&gt;返回随机元素&lt;/h2&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// method1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; ary = [&lt;span class=&quot;string&quot;&gt;&#39;male&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;female&#39;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; ret = ary[~~(&lt;span class=&quot;built_in&quot;&gt;Math&lt;/span&gt;.random() * ary.length)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// method2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;].sort(() =&amp;gt; &amp;#123;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; v = &lt;span class=&quot;built_in&quot;&gt;Math&lt;/span&gt;.random() - &lt;span class=&quot;number&quot;&gt;.5&lt;/span&gt;; &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; v / &lt;span class=&quot;built_in&quot;&gt;Math&lt;/span&gt;.abs(v);&amp;#125;).shift();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;u8BA1_u7B97_u51FA_u5B57_u7B26_u4E32_u4E2D_u5B57_u7B26_u51FA_u73B0_u6B21_u6570&quot;&gt;&lt;a href=&quot;#u8BA1_u7B97_u51FA_u5B57_u7B26_u4E32_u4E2D_u5B57_u7B26_u51FA_u73B0_u6B21_u6570&quot; class=&quot;headerlink&quot; title=&quot;计算出字符串中字符出现次数&quot;&gt;&lt;/a&gt;计算出字符串中字符出现次数&lt;/h2&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&#39;abcdaabc&#39;&lt;/span&gt;.split(&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;).reduce((p, c) =&amp;gt; (p[c] = (p[c] || &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, p) , &amp;#123;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u53CD_u8F6C_u4E00_u4E2A_u5B57_u7B26_u4E32&quot;&gt;&lt;a href=&quot;#u53CD_u8F6C_u4E00_u4E2A_u5B57_u7B26_u4E32&quot; class=&quot;headerlink&quot; title=&quot;反转一个字符串&quot;&gt;&lt;
    
    </summary>
    
      <category term="javascript" scheme="http://coderq.github.io/categories/javascript/"/>
    
    
      <category term="javascript" scheme="http://coderq.github.io/tags/javascript/"/>
    
  </entry>
  
</feed>
