<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>CoderQ·博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="CoderQ·博客">
<meta property="og:url" content="http://coderq.github.io/index.html">
<meta property="og:site_name" content="CoderQ·博客">
<meta property="og:description" content="个人博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CoderQ·博客">
<meta name="twitter:description" content="个人博客">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xqex1.com1.z0.glb.clouddn.com/avatar%2F1426483393_DXGAJIiR.jpeg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">CoderQ</a></h1>
		</hgroup>

		
		<p class="header-subtitle">不积硅步无以至千里(旧博客地址：http://blog.coderq.net)</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>Tags</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/coderq" title="github">github</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/flex/" style="font-size: 10px;">flex</a> <a href="/tags/http/" style="font-size: 20px;">http</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/mongodb/" style="font-size: 15px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 15px;">node.js</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/stream-node-js/" style="font-size: 10px;">stream node.js</a> <a href="/tags/微信/" style="font-size: 10px;">微信</a> <a href="/tags/状态码/" style="font-size: 10px;">状态码</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">CoderQ</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://7xqex1.com1.z0.glb.clouddn.com/avatar%2F1426483393_DXGAJIiR.jpeg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">CoderQ</h1>
			</hgroup>
			
			<p class="header-subtitle">不积硅步无以至千里(旧博客地址：http://blog.coderq.net)</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/coderq" title="github">github</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-javascript-useful-functions" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/18/javascript-useful-functions/" class="article-date">
  	<time datetime="2016-03-18T00:55:24.000Z" itemprop="datePublished">2016-03-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/18/javascript-useful-functions/">自己写的一些常用函数</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u968F_u673A_u5B57_u7B26_u4E32_u51FD_u6570"><a href="#u968F_u673A_u5B57_u7B26_u4E32_u51FD_u6570" class="headerlink" title="随机字符串函数"></a>随机字符串函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * &#29983;&#25104;&#38543;&#26426;&#23383;&#31526;&#20018;&#10; *&#10; * @param total &#23383;&#31526;&#20018;&#38271;&#24230;&#10; * @param method &#23383;&#31526;&#20018;&#31867;&#22411;&#65292;&#25968;&#23383;&#65295;&#23567;&#20889;&#23383;&#27597;&#65295;&#22823;&#20889;&#23383;&#27597;&#10; * @return string&#10; */&#10;var randomString = function(total, method) &#123;&#10;    var codes = [], ret = &#39;&#39;;&#10;    method = method || 7;&#10;    if (method &#38; randomString.number) &#123;&#10;        var number_codes = new Array(10).fill(0).map(function(item, index) &#123;return 48 + index;&#125;);&#10;        codes = codes.concat(number_codes);&#10;    &#125;&#10;    if (method &#38; randomString.lower) &#123;&#10;        var number_codes = new Array(26).fill(0).map(function(item, index) &#123;return 97 + index;&#125;);&#10;        codes = codes.concat(number_codes);&#10;    &#125;&#10;    if (method &#38; randomString.upper) &#123;&#10;        var number_codes = new Array(26).fill(0).map(function(item, index) &#123;return 65 + index;&#125;);&#10;        codes = codes.concat(number_codes);&#10;    &#125;&#10;    while (total--) &#123;&#10;        ret += String.fromCharCode(codes[Math.floor(Math.random() * codes.length)]);&#10;    &#125;&#10;    return ret;&#10;&#125;;&#10;/**&#10; * &#25968;&#23383;&#10; */&#10;randomString.number = 1;&#10;/** &#10; * &#23567;&#20889;&#23383;&#27597;&#10; */&#10;randomString.lower = 2;&#10;/**&#10; * &#22823;&#20889;&#23383;&#27597;&#10; */&#10;randomString.upper = 4;</span><br></pre></td></tr></table></figure>
<h2 id="u7EE7_u627F_u51FD_u6570"><a href="#u7EE7_u627F_u51FD_u6570" class="headerlink" title="继承函数"></a>继承函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var extend = function() &#123;&#10;    var params = Array.prototype.slice.call(arguments),&#10;        method = &#39;number&#39; == typeof params[params.length - 1] ? params.pop() : 0,&#10;        ret = method &#38; extend.replaceFirst ? params.shift() : &#123;&#125;,&#10;        deep = method &#38; extend.deepExtend,&#10;        rmNull = method &#38; extend.removeNull,&#10;        obj;&#10;&#10;    while (params.length) &#123;&#10;        obj = params.shift();&#10;        for (var k in obj) &#123;&#10;            if (null === obj[k]) &#123;&#10;                rmNull ? delete ret[k] : ret[k] = obj[k];&#10;            &#125; else if (!ret[k] || ret[k].constructor !== Object || obj[k].constructor !== Object) &#123;&#10;                ret[k] = obj[k];&#10;            &#125; else &#123;&#10;                ret[k] = deep ? extend(ret[k], obj[k], method) : obj[k];&#10;            &#125;&#10;        &#125;&#10;    &#125;&#10;    return ret;&#10;&#125;;&#10;/**&#10; * &#23558;&#32467;&#26524;&#36171;&#20540;&#32473;&#31532;&#19968;&#20010;&#23545;&#35937;&#10; */&#10;extend.replaceFirst = extend.RF = 1;&#10;/**&#10; * &#28145;&#24230;&#21512;&#24182;&#10; */&#10;extend.deepExtend = extend.DE = 2;&#10;/**&#10; * &#21024;&#38500;&#20540;&#20026;null&#30340;&#38190;&#10; */&#10;extend.removeNull = extend.RN = 4;</span><br></pre></td></tr></table></figure>
<h2 id="u5B57_u7B26_u4E32_u53CA_u65F6_u95F4_u683C_u5F0F_u5316_u51FD_u6570"><a href="#u5B57_u7B26_u4E32_u53CA_u65F6_u95F4_u683C_u5F0F_u5316_u51FD_u6570" class="headerlink" title="字符串及时间格式化函数"></a>字符串及时间格式化函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;/**&#10; * &#23383;&#31526;&#20018;&#26684;&#24335;&#21270;&#26041;&#27861;&#10; * @params null&#10; * @example _.format(&#39;&#25105;&#26159;&#123;0&#125;&#39;, &#39;CoderQ&#39;) =&#62; &#39;&#25105;&#26159;CoderQ&#39;; &#39;&#25105;&#26159;&#123;name&#125;&#39;.format(&#123;name:&#39;CoderQ&#39;&#125;) =&#62; &#39;&#25105;&#26159;CoderQ&#39;;&#10; * @depends null&#10; * @return string&#10; */&#10;var string_format = function() &#123;&#10;    var args = Array.prototype.slice.call(arguments),&#10;        string = args.shift(),&#10;        params = &#39;object&#39; == typeof args[0] ? args[0] : args;&#10;    return string.replace(/\&#123;(\w+)(\|([^&#125;]+))?\&#125;/g, function($, $1, $2, $3) &#123;&#10;        return &#39;undefined&#39; == typeof params[$1] ? eval($3) : params[$1];&#10;    &#125;);&#10;&#125;;&#10;&#10;/**&#10; * &#26102;&#38388;&#26684;&#24335;&#21270;&#20989;&#25968;&#10; * @params&#10; *    format &#26684;&#24335;&#10; *    language &#35821;&#35328;&#10; * @example new Date().format(&#39;Y-m-d H:i:s&#39;)&#10; * @depends toString&#10; * @return string&#10; */&#10;var date_format = function(format, date, lang) &#123;&#10;    var _format = format || &#39;&#39;;&#10;    var _lang = lang || &#39;zh&#39;;&#10;    var _month_text = &#123;&#10;        &#39;zh&#39;: [&#39;&#19968;&#39;, &#39;&#20108;&#39;, &#39;&#19977;&#39;, &#39;&#22235;&#39;, &#39;&#20116;&#39;, &#39;&#20845;&#39;, &#39;&#19971;&#39;, &#39;&#20843;&#39;, &#39;&#20061;&#39;, &#39;&#21313;&#39;, &#39;&#21313;&#19968;&#39;, &#39;&#21313;&#20108;&#39;],&#10;        &#39;en&#39;: [&#39;Jan&#39;, &#39;Feb&#39;, &#39;Mar&#39;, &#39;Apr&#39;, &#39;May&#39;, &#39;Jun&#39;, &#39;Jul&#39;, &#39;Aug&#39;, &#39;Sep&#39;, &#39;Oct&#39;, &#39;Nov&#39;, &#39;Dec&#39;]&#10;    &#125;;&#10;    var _day_text = &#123;&#10;        &#39;zh&#39;: [&#39;&#26085;&#39;, &#39;&#19968;&#39;, &#39;&#20108;&#39;, &#39;&#19977;&#39;, &#39;&#22235;&#39;, &#39;&#20116;&#39;, &#39;&#20845;&#39;],&#10;        &#39;en&#39;: [&#39;Sun&#39;, &#39;Mon&#39;, &#39;Tues&#39;, &#39;Wed&#39;, &#39;Thur&#39;, &#39;Fri&#39;, &#39;Sat&#39;]&#10;    &#125;;&#10;    var _year = date.getFullYear();&#10;    var _month = date.getMonth() + 1;&#10;    var _date = date.getDate();&#10;    var _day = date.getDay();&#10;    var _hour = date.getHours();&#10;    var _minute = date.getMinutes();&#10;    var _second = date.getSeconds();&#10;    return _format.replace(/Y/g, _year)&#10;        .replace(/y/g, _year.toString().substr(2))&#10;        .replace(/M/g, _month_text[_lang][_month - 1])&#10;        .replace(/m/g, _month &#62; 9 ? _month : &#39;0&#39; + _month)&#10;        .replace(/n/g, _month)&#10;        .replace(/D/g, _day_text[_lang][_day])&#10;        .replace(/d/g, _date &#62; 9 ? _date : &#39;0&#39; + _date)&#10;        .replace(/j/g, _date)&#10;        .replace(/H/g, _hour &#62; 9 ? _hour : &#39;0&#39; + _hour)&#10;        .replace(/G/g, _hour)&#10;        .replace(/h/g, (_hour % 12) &#62; 9 ? (_hour % 12) : &#39;0&#39; + (_hour % 12))&#10;        .replace(/g/g, _hour % 12)&#10;        .replace(/i/g, _minute &#62; 9 ? _minute : &#39;0&#39; + _minute)&#10;        .replace(/s/g, _second &#62; 9 ? _second : &#39;0&#39; + _second);&#10;&#125;;&#10;&#10;/**&#10; * &#25968;&#25454;&#26684;&#24335;&#21270;&#10; * @param format&#10; * @param obj&#10; * @return string&#10; */&#10;var format = function(format, obj) &#123;&#10;    if (Object.prototype.toString.call(obj) == &#39;[object Date]&#39;) &#123;&#10;        return date_format.apply(null, arguments);&#10;    &#125; else &#123;&#10;        return string_format.apply(null, arguments);&#10;    &#125;&#10;&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/javascript/">javascript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-weixin-jssdk" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/18/weixin-jssdk/" class="article-date">
  	<time datetime="2016-03-17T23:58:57.000Z" itemprop="datePublished">2016-03-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/18/weixin-jssdk/">实现记录微信分享路径树的功能</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u80CC_u666F"><a href="#u80CC_u666F" class="headerlink" title="背景"></a>背景</h2><p>接运营要求，希望记录文章被某个人分享出去之后的路径树，但因为微信分享时是无法获取到用户信息的，所以能记录的信息只有原始分享用户以及他分享出去后的路径树。</p>
<h2 id="u5B9E_u73B0_u65B9_u6CD5"><a href="#u5B9E_u73B0_u65B9_u6CD5" class="headerlink" title="实现方法"></a>实现方法</h2><p>当文章被分享出去时，我们的URL里记录有文章ID及用户ID，当页面被打开时，后端会生成一个share_id，以query的方式加到当前URL的后面，当页面被再次分享出去时，后端会根据这个share_id再生成一个下级的share_id，并记录他们之间的关系，而之前的share_id在数据库里的记录会被更新为已读。</p>
<h2 id="u5FAE_u4FE1_u7B7E_u540D_u751F_u6210_u89C4_u5219"><a href="#u5FAE_u4FE1_u7B7E_u540D_u751F_u6210_u89C4_u5219" class="headerlink" title="微信签名生成规则"></a>微信签名生成规则</h2><p>签名的生成需要以下四个参数</p>
<ul>
<li>jsapi_ticket 先通过appId获取access_token，在通过access_token获取jsapi_ticket</li>
<li>noncestr 随机字符串</li>
<li>timestamp 时间戳（秒级）</li>
<li>url 当前页面URL，<em>是当前页面URL，而不是要分享出去的URL</em><br>最后形成一段与此类似的字符串<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jsapi_ticket=sM4AOVdWfPE4DxkXGEs8VMCPGGVi4C3VM0P37wVUCFvkVAy_90u5h9nbSlYy3-Sl-HhTdfl2fzFy1AOcHKP7qg&#38;noncestr=Wm3WZYTPz0wzccnW&#38;timestamp=1414587457&#38;url=http://mp.weixin.qq.com?params=value</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在经过sha1加密，得到signature</p>
<h2 id="u6570_u636E_u6A21_u578B"><a href="#u6570_u636E_u6A21_u578B" class="headerlink" title="数据模型"></a>数据模型</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var WeixinShareLogSchema = new Schema(&#123;&#10;    _id: &#123;type: String, unique: true, required: true&#125;,&#10;    parent_id: &#123;type: String, ref: &#39;weixin_share_log&#39;&#125;,&#10;    article_id: &#123;type: ObjectId, ref: &#39;article&#39;, required: true&#125;,&#10;    is_read: &#123;type: Boolean, default: false&#125;,&#10;    created_by : &#123;type : String, required: true&#125;,&#10;    created_at : &#123;type : Date, default : Date.now&#125;&#10;&#125;);&#10;&#36890;&#36807;&#36825;&#31181;&#32467;&#26500;&#65292;&#25105;&#20204;&#21482;&#35201;&#25628;&#32034;created_by&#20877;&#21152;&#19978;&#21069;&#31471;&#30340;&#24322;&#27493;&#23454;&#29616;&#23601;&#33021;&#30693;&#36947;&#34987;&#35813;&#29992;&#25143;&#20998;&#20139;&#20986;&#21435;&#30340;&#25991;&#31456;&#30340;&#26641;&#29366;&#32467;&#26500;&#20102;&#12290;</span><br></pre></td></tr></table></figure>
<h2 id="u540E_u7AEF_u5B9E_u73B0"><a href="#u540E_u7AEF_u5B9E_u73B0" class="headerlink" title="后端实现"></a>后端实现</h2><p><em>因项目历史原因，没有使用es6</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">......&#10;// &#20998;&#20139;ID&#65292;&#22914;&#26524;&#26159;&#31532;&#19968;&#27425;&#20998;&#20139;&#65292;&#21017;&#20026;&#29992;&#25143;ID&#10;var parent_id = this.request.query.share_id || &#39;&#39;;&#10;// &#29983;&#25104;&#19968;&#20010;&#19979;&#32423;&#20998;&#20139;ID&#10;var share_id = md5(parent_id + Date.now());&#10;var WeixinShareLogModel = mongoose.model(&#39;weixinsharelog&#39;);&#10;// &#23558;&#24403;&#21069;&#30340;&#20998;&#20139;ID&#32622;&#20026;&#24050;&#35835;&#10;var e_weixin_share_log = yield WeixinShareLogModel.findOne(&#123;_id: parent_id&#125;).exec();&#10;if (e_weixin_share_log) &#123;&#10;    e_weixin_share_log.is_read = true;&#10;    yield e_weixin_share_log.save();&#10;&#125;&#10;e_weixin_share_log = new WeixinShareLogModel(&#123;&#10;    _id: share_id,&#10;    parent_id: parent_id,&#10;    article_id: article_id,&#10;    created_by: user_id&#10;&#125;);&#10;yield e_weixin_share_log.save();&#10;// url&#23450;&#20041;&#24494;&#20449;&#35201;&#27714;&#30340;&#29992;&#20110;&#33719;&#21462;&#31614;&#21517;&#30340;&#22320;&#22336;&#65292;&#38500;#&#21495;&#20043;&#21518;&#30340;&#21097;&#20313;&#37096;&#20998;&#10;var url = Tools.format(&#39;&#123;protocol&#125;://&#123;host&#125;&#123;url&#125;&#39;, &#123;&#10;    protocol: config.protocol,&#10;    host: config.host,&#10;    url: this.url.split(&#39;#&#39;).shift()&#10;&#125;);&#10;// &#33719;&#21462;&#24494;&#20449;&#31614;&#21517;&#10;var sign = yield Tools.getWeixinSignature(url);&#10;// &#29983;&#25104;&#19979;&#32423;&#20998;&#20139;&#22320;&#22336;&#10;var share_url = Tools.format(&#39;&#123;url&#125;?share_id=&#123;share_id&#125;&#39;, &#123;&#10;    url: url.split(&#39;?&#39;).shift(),&#10;    share_id: share_id&#10;&#125;);&#10;......</span><br></pre></td></tr></table></figure></p>
<p>获取微信签名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * &#33719;&#21462;&#24494;&#20449;&#31614;&#21517;&#10; */&#10;var getWeixinSignature = function* (url) &#123;&#10;    function* getWeixinTicket() &#123;&#10;        var data = yield request.get(format(config.weixin.path.access_token, config.weixin));&#10;        return yield request.get(format(config.weixin.path.ticket, &#123;access_token: data.access_token&#125;));&#10;    &#125;&#10;    try &#123;&#10;        var data, expire, nonce_str, timestamp, jsapi_ticket, signature;&#10;        // &#22914;&#26524;&#36807;&#26399;&#26102;&#38388;&#19981;&#23384;&#22312;&#25110;&#20165;&#23384;200&#31186;&#65292;&#21017;&#37325;&#26032;&#33719;&#21462;jsapi_ticket&#65292;&#24182;&#37325;&#32622;&#36807;&#26399;&#26102;&#38388;&#10;        if (!getWeixinSignature.expire || getWeixinSignature.expire &#62; new Date() - 200 * 1000) &#123;&#10;            data = yield getWeixinTicket();&#10;            getWeixinSignature.expire = data.expires_in * 1000 + new Date().getTime();&#10;            getWeixinSignature.jsapi_ticket = data.ticket;&#10;        &#125;&#10;        if (!getWeixinSignature.jsapi_ticket) return false;&#10;        nonce_str = randomString(16);&#10;        timestamp = Math.floor(new Date().getTime() / 1000);&#10;        signature = sha1(format(&#34;jsapi_ticket=&#123;jsapi_ticket&#125;&#38;noncestr=&#123;nonce_str&#125;&#38;timestamp=&#123;timestamp&#125;&#38;url=&#123;url&#125;&#34;, &#123;&#10;            jsapi_ticket: getWeixinSignature.jsapi_ticket,&#10;            nonce_str: nonce_str,&#10;            timestamp: timestamp,&#10;            url: url&#10;        &#125;));&#10;        return &#123;&#10;            appId: config.weixin.app_id,&#10;            timestamp: timestamp,&#10;            nonceStr: nonce_str,&#10;            signature: signature&#10;        &#125;&#10;    &#125; catch (e) &#123;&#10;        console.log(e.stack);&#10;        return false;&#10;    &#125;&#10;&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="u524D_u7AEF_u914D_u7F6E"><a href="#u524D_u7AEF_u914D_u7F6E" class="headerlink" title="前端配置"></a>前端配置</h2><ul>
<li>引入文件<a href="https://res.wx.qq.com/open/js/jweixin-1.0.0.js" target="_blank" rel="external">https://res.wx.qq.com/open/js/jweixin-1.0.0.js</a></li>
<li>定义配置信息<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wx.config(&#123;&#10;    debug: false, &#10;    appId: &#39;&#60;%= sign.appId %&#62;&#39;,&#10;    nonceStr: &#39;&#60;%= sign.nonceStr %&#62;&#39;,&#10;    timestamp: &#39;&#60;%= sign.timestamp %&#62;&#39;,&#10;    signature: &#39;&#60;%= sign.signature %&#62;&#39;,&#10;    jsApiList: [&#10;        &#34;onMenuShareTimeline&#34;,&#10;        &#34;onMenuShareAppMessage&#34;,&#10;        &#34;onMenuShareQQ&#34;,&#10;        &#34;onMenuShareWeibo&#34;,&#10;        &#34;hideOptionMenu&#34;,&#10;        &#34;showOptionMenu&#34;&#10;    ]&#10;&#125;);&#10;wx.ready(function() &#123;&#10;&#9;var desc = $(&#39;meta[name=description]&#39;).attr(&#39;content&#39;) || $(&#39;body&#39;).find(&#39;h1,h2,h3,h4,p&#39;).eq(0).text() || &#39;&#32654;&#20029;&#38405;&#35835;&#25991;&#31456;&#20998;&#20139;&#39;;&#10;&#9;var image_url = $(&#39;body&#39;).find(&#39;img&#39;).get(0).src;&#10;    var shareInfo = &#123;&#10;        title: &#39;&#60;%= article_title %&#62;&#39;,&#10;        desc: desc,&#10;        imgUrl: image_url,&#10;        link: &#39;&#60;%= share_url %&#62;&#39;&#10;    &#125;;&#10;    /*&#20998;&#20139;&#21040;&#26379;&#21451;&#22280;*/&#10;    wx.onMenuShareTimeline(shareInfo);&#10;    //&#33719;&#21462;&#8220;&#20998;&#20139;&#32473;&#26379;&#21451;&#8221;&#25353;&#38062;&#28857;&#20987;&#29366;&#24577;&#21450;&#33258;&#23450;&#20041;&#20998;&#20139;&#20869;&#23481;&#25509;&#21475;&#10;    wx.onMenuShareAppMessage(shareInfo);&#10;    //&#33719;&#21462;&#8220;&#20998;&#20139;&#21040;QQ&#8221;&#25353;&#38062;&#28857;&#20987;&#29366;&#24577;&#21450;&#33258;&#23450;&#20041;&#20998;&#20139;&#20869;&#23481;&#25509;&#21475;&#10;    wx.onMenuShareQQ(shareInfo);&#10;    //&#33719;&#21462;&#8220;&#20998;&#20139;&#21040;&#33150;&#35759;&#24494;&#21338;&#8221;&#25353;&#38062;&#28857;&#20987;&#29366;&#24577;&#21450;&#33258;&#23450;&#20041;&#20998;&#20139;&#20869;&#23481;&#25509;&#21475;&#10;    wx.onMenuShareWeibo(shareInfo);&#10;&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>具体JSSDK配置请参考<a href="https://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html" target="_blank" rel="external">微信官方文档</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/微信/">微信</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/微信/">微信</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-flex-stylesheet-study" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/17/flex-stylesheet-study/" class="article-date">
  	<time datetime="2016-03-17T00:05:06.000Z" itemprop="datePublished">2016-03-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/17/flex-stylesheet-study/">flex布局学习</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="flex_u5F39_u6027_u5E03_u5C40"><a href="#flex_u5F39_u6027_u5E03_u5C40" class="headerlink" title="flex弹性布局"></a>flex弹性布局</h2><p>有了flex，妈妈再也不用担心我不会写双飞布局了。N飞都行。</p>
<h2 id="flex"><a href="#flex" class="headerlink" title="flex"></a>flex</h2><p>html:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div class=&#34;container&#34;&#62;&#10;  &#60;div class=&#34;left&#34;&#62;&#10;    &#60;ul&#62;&#10;      &#60;li&#62;1&#60;/li&#62;&#10;      &#60;li&#62;2&#60;/li&#62;&#10;      &#60;li&#62;3&#60;/li&#62;&#10;      &#60;li&#62;4&#60;/li&#62;&#10;      &#60;li&#62;5&#60;/li&#62;&#10;      &#60;li&#62;6&#60;/li&#62;&#10;    &#60;/ul&#62;&#10;  &#60;/div&#62;&#10;  &#60;div class=&#34;center&#34;&#62;&#60;/div&#62;&#10;  &#60;div class=&#34;right&#34;&#62;&#60;/div&#62;&#10;&#60;/div&#62;</span><br></pre></td></tr></table></figure></p>
<p>css:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.container &#123;&#10;  display: flex;&#10;&#125;&#10;&#10;.left, .right &#123;&#10;  width: 200px;&#10;  background-color: #ccc;&#10;&#125;&#10;&#10;.center &#123;&#10;  flex: 1;&#10;  background-color: #333;&#10;  /* min-width: 480px; */&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="https://jsfiddle.net/CoderQ/hcyxgdxw/2/" target="_blank" rel="external">在线demo</a></p>
<h2 id="align-content"><a href="#align-content" class="headerlink" title="align-content"></a>align-content</h2><p>定义弹性元素在垂直及水平方向上有剩余空间时如何呈现每一行，如果弹性容器只有一行，则无效。（所有元素拉伸占满所有空间）</p>
<p>| 默认值 | stretch |<br>| 使用元素 | 多行弹性元素 |<br>| 支持继承 | 否 |<br>| 使用媒体 | 可见的 |</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">align-content: flex-start | center | flex-end | space-between | space-around | stretch;</span><br></pre></td></tr></table></figure>
<p><a href="https://jsfiddle.net/CoderQ/dgLs06fr/6/" target="_blank" rel="external">在线demo</a></p>
<h2 id="u53C2_u8003_u8D44_u6599"><a href="#u53C2_u8003_u8D44_u6599" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Flexible_Box_Layout" target="_blank" rel="external">https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Flexible_Box_Layout</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/">css</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flex/">flex</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/html-css/">html+css</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-nodejs-stream" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/09/nodejs-stream/" class="article-date">
  	<time datetime="2016-03-09T00:56:50.000Z" itemprop="datePublished">2016-03-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/09/nodejs-stream/">node.js使用stream处理大文件</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u57FA_u7840_u7684_u6D41_u5904_u7406"><a href="#u57FA_u7840_u7684_u6D41_u5904_u7406" class="headerlink" title="基础的流处理"></a>基础的流处理</h2><p>当文件比较大的时候，例如GB级的日志文件，直接把文件整个读进来显然不太合适，这时候我们需要用到流的处理。</p>
<h3 id="u8BFB"><a href="#u8BFB" class="headerlink" title="读"></a>读</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;&#10;&#10;let fs = require(&#39;fs&#39;);&#10;let file = &#39;image_info.csv&#39;;&#10;let readerStream = fs.createReadStream(__dirname + &#39;/&#39; + file);&#10;readerStream.setEncoding(&#39;utf8&#39;);&#10;&#10;let _data;&#10;readerStream.on(&#39;data&#39;, function(data) &#123;&#10;&#9;var data = (_data + data).split(&#34;\n&#34;);&#10;&#9;_data = data.pop();&#10;&#9;// console.log(&#39;-----------------------&#39;);&#10;&#9;data.forEach(function(item) &#123;&#10;&#9;&#9;console.log(item);&#10;&#9;&#125;)&#10;&#125;)&#10;&#10;readerStream.on(&#39;end&#39;, function() &#123;&#10;&#9;console.log(&#39;end&#39;);&#10;&#125;)&#10;&#10;readerStream.on(&#39;error&#39;, function(err)&#123;&#10;   console.log(err.stack);&#10;&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stream-node-js/">stream node.js</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/node-js/">node.js</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-javascript-proto-prototype-constructor" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/08/javascript-proto-prototype-constructor/" class="article-date">
  	<time datetime="2016-03-08T02:35:59.000Z" itemprop="datePublished">2016-03-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/08/javascript-proto-prototype-constructor/">Javascript继承之理解__proto__、prototype、constructor三者的含义与用法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u5982_u4F55_u5199_u51FA_u6CA1_u6709_u6C61_u67D3_u7684_u7EE7_u627F"><a href="#u5982_u4F55_u5199_u51FA_u6CA1_u6709_u6C61_u67D3_u7684_u7EE7_u627F" class="headerlink" title="如何写出没有污染的继承"></a>如何写出没有污染的继承</h2><p>1.javascript中一切都是对象，每个对象都是基于原型对象创建的，每个对象中都有<strong>proto</strong>属性，这个属性指向的就是它基于的原型对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var Foo = function () &#123;&#125;;&#10;var foo = new Foo(); &#10;console.log(&#10;    Foo.__proto__ === Function.prototype, // true&#10;    foo.__proto__ === Foo.prototype, // true&#10;);</span><br></pre></td></tr></table></figure></p>
<p>2.只有构造函数对象才有prototype属性，构造函数的作用是创建对象，创建对象的时候，它要知道这个对象基于哪个原型来创建，这个prototype指向的就是这个原型。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var Foo = function () &#123;&#125;;&#10;// Foo.prototype &#25351;&#21521; Foo.prototype;</span><br></pre></td></tr></table></figure></p>
<p>3.只有原型对象才有constructor属性，而且也是系统（浏览器）给创建的。前面说过构造函数对象的prototype属性会指向一个原型对象，那么这个原型对象中的constructor属性指向的就是这个构造函数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var Foo = function () &#123;&#125;;&#10;var foo = new Foo(); &#10;console.log(&#10;    foo.constructor === Foo, // true&#10;);</span><br></pre></td></tr></table></figure></p>
<p>4.思想合并<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var Parent = function () &#123;&#10;    this.name = &#39;parent&#39;;&#10;&#125;;&#10;Parent.prototype.sayName = function () &#123;&#10;    alert(this.name);&#10;&#125;;&#10;&#10;var Son = function () &#123;&#10;    Parent.apply(this, arguments);&#10;    this.name = &#39;son&#39;;&#10;&#125;;&#10;Son.prototype.__proto__ = Parent.prototype;&#10;&#10;var parent = new Parent();&#10;var son = new Son();&#10;parent.sayName();&#10;son.sayName();&#10;&#10;console.log(&#10;    Parent.__proto__ === Function.prototype,&#10;    parent.__proto__ === Parent.prototype,&#10;    parent.constructor === Parent,&#10;    Son.__proto__ === Function.prototype,&#10;    son.__proto__ === Son.prototype,&#10;    son.constructor === Son&#10;);</span><br></pre></td></tr></table></figure></p>
<h2 id="u53C2_u8003_u8D44_u6599"><a href="#u53C2_u8003_u8D44_u6599" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://www.ruanyifeng.com/blog/2011/06/designing_ideas_of_inheritance_mechanism_in_javascript.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2011/06/designing_ideas_of_inheritance_mechanism_in_javascript.html</a></li>
<li><a href="http://blogzhoubo.iteye.com/blog/1685368" target="_blank" rel="external">http://blogzhoubo.iteye.com/blog/1685368</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/javascript/">javascript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-javascript-es5-useless-tech" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/08/javascript-es5-useless-tech/" class="article-date">
  	<time datetime="2016-03-08T02:18:38.000Z" itemprop="datePublished">2016-03-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/08/javascript-es5-useless-tech/">Javascript中一些可能是用较少的语法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="set/get"><a href="#set/get" class="headerlink" title="set/get"></a>set/get</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var data = &#123;&#10;&#9;items: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;],&#10;&#9;get length () &#123;&#10;&#9;&#9;return this.items.length;&#10;&#9;&#125;,&#10;&#9;set first (val) &#123;&#10;&#9;&#9;this.items[0] = val;&#10;&#9;&#125;&#10;&#125;;&#10;console.log(data.length); // 3&#10;data.length = 4; // &#20005;&#26684;&#27169;&#24335;&#19979;&#25253;&#38169;&#65306;Uncaught TypeError: Cannot set property length of #&#60;Object&#62; which has only a getter(&#8230;)&#10;console.log(data.first = &#39;d&#39;);&#10;console.log(data.items); // [&#34;d&#34;, &#34;b&#34;, &#34;c&#34;]&#10;&#10;var MyDate = function() &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="defineGetter/defineSetter"><a href="#defineGetter/defineSetter" class="headerlink" title="defineGetter/defineSetter"></a><strong>defineGetter</strong>/<strong>defineSetter</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var data = &#123;&#10;&#9;items: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]&#10;&#125;;&#10;data.__defineGetter__(&#39;length&#39;, function() &#123;return this.items.length;&#125;);&#10;data.__defineSetter__(&#39;first&#39;, function(val) &#123;this.items[0] = val;&#125;)&#10;console.log(data.length); // 3&#10;console.log(data.first = &#39;d&#39;);&#10;console.log(data.items); // [&#34;d&#34;, &#34;b&#34;, &#34;c&#34;]</span><br></pre></td></tr></table></figure>
<h2 id="Object-freeze"><a href="#Object-freeze" class="headerlink" title="Object.freeze"></a>Object.freeze</h2><p>将某个对象<em>冻住</em>，好形象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var a = &#123;a:1, b: 2&#125;; &#10;Object.freeze(a); &#10;a.c =3;&#10;console.log(a); // &#123;a: 1, b: 2&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Object-defineProperty"><a href="#Object-defineProperty" class="headerlink" title="Object.defineProperty"></a>Object.defineProperty</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var obj1 = &#123;&#125;;&#10;Object.defineProperty(obj1, &#34;x&#34;, &#123; value: 42, writable: false &#125;);&#10;obj1.x = 9; // &#20005;&#26684;&#27169;&#24335;&#19979;&#25243;&#20986;TypeError&#38169;&#35823;&#10;console.log(obj1.x); // 42</span><br></pre></td></tr></table></figure>
<h2 id="Object-preventExtensions"><a href="#Object-preventExtensions" class="headerlink" title="Object.preventExtensions"></a>Object.preventExtensions</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#32473;&#19981;&#21487;&#25193;&#23637;&#23545;&#35937;&#30340;&#26032;&#23646;&#24615;&#36171;&#20540;&#10;var fixed = &#123;&#125;;&#10;Object.preventExtensions(fixed);&#10;fixed.newProp = &#34;ohai&#34;; // &#20005;&#26684;&#27169;&#24335;&#19979;&#25243;&#20986;TypeError&#38169;&#35823;&#10;console.log(fixed); // &#123;&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/2428409/how-can-you-make-a-variable-object-read-only-in-javascript" target="_blank" rel="external">http://stackoverflow.com/questions/2428409/how-can-you-make-a-variable-object-read-only-in-javascript</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-npm-useful-logs" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/08/npm-useful-logs/" class="article-date">
  	<time datetime="2016-03-07T23:48:25.000Z" itemprop="datePublished">2016-03-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/08/npm-useful-logs/">npm命令使用</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>npm install</code> will install both “dependencies” and “devDependencies”</p>
<p><code>npm install --production</code> will only install “dependencies”</p>
<p><code>npm install --dev</code> will only install “devDependencies”</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-nginx-config" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/03/nginx-config/" class="article-date">
  	<time datetime="2016-03-03T00:41:07.000Z" itemprop="datePublished">2016-03-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/03/nginx-config/">nginx配置</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u5168_u5C40_u914D_u7F6E"><a href="#u5168_u5C40_u914D_u7F6E" class="headerlink" title="全局配置"></a>全局配置</h2><h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><p>用于指定nginx进程运行用户以及用户组，默认情况下将使用与用户名相同的组，除非编译时指定–user=USER和–group=GROUP</p>
<h3 id="worker_processes"><a href="#worker_processes" class="headerlink" title="worker_processes"></a>worker_processes</h3><p>用于指定nginx的进程数，一般设置为与CPU核数一致即可。</p>
<h3 id="error_log"><a href="#error_log" class="headerlink" title="error_log"></a>error_log</h3><p>用于指定全局错误日志文件，日志错误级别包括debug,info,notice,warn,error,crit，日志的信息量由debug到crit递减。</p>
<p>nginx支持为每个虚拟主机配置不同的日志文件，如果在编译安装的时候加入–with-debug参数，可以使用以下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_log LOGFILE [debug_core | debug_alloc | debug_mutex | debug_event | debug_http | debug_imap];</span><br></pre></td></tr></table></figure></p>
<p><strong>error_log off</strong>并不能关闭日志记录，而会将日志文件写入另一个文件名为off的文件中，如果你想关闭错误日志功能 ，应使用以下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_log  /dev/null crit;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;&#10;worker_processes  auto;&#10;&#10;#error_log  logs/error.log;&#10;#error_log  logs/error.log  notice;&#10;#error_log  logs/error.log  info;&#10;&#10;#pid        logs/nginx.pid;&#10;&#10;events &#123;&#10;    worker_connections  1024;&#10;    multi_accept on;&#10;&#125;&#10;&#10;http &#123;&#10;    include       mime.types;&#10;    default_type  application/octet-stream;&#10;&#10;    server_tokens   off;&#10;    sendfile        on;&#10;    tcp_nopush      on;&#10;    tcp_nodelay     on;&#10;&#10;    keepalive_timeout  65;&#10;    &#10;    server &#123;&#10;        listen 80;&#10;        server_name local.tms.shenba.com;&#10;&#10;        location / &#123;&#10;            proxy_set_header Host $host;&#10;            proxy_set_header X-Real-IP $remote_addr;&#10;            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;            proxy_buffering off;&#10;            proxy_pass           http://localhost:3445;&#10;        &#125;&#10;&#10;        &#10;    &#125;&#10;&#10;    server &#123;&#10;        listen 80;&#10;        server_name local.h5.shenba.com;&#10;&#10;        location / &#123;&#10;            proxy_set_header Host $host;&#10;            proxy_set_header X-Real-IP $remote_addr;&#10;            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;            proxy_buffering off;&#10;            proxy_pass           http://localhost:3446;&#10;        &#125;&#10;    &#125;&#10;&#10;    server &#123;&#10;        listen 80;&#10;        server_name local.h5statics.shenba.com;&#10;&#10;        root /Users/CoderQ/shenba/code/h5statics.shenba.com;&#10;    &#125;&#10;&#10;    server &#123;&#10;        listen 80;&#10;        server_name local.dian.shenba.com;&#10;        #access_log /var/log/nginx/node_h5site.log&#10;        location / &#123;&#10;            proxy_set_header    X-Real-IP           $remote_addr;&#10;            proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;&#10;            proxy_set_header    Host                $http_host;&#10;            proxy_set_header    X-NginX-Proxy       true;&#10;            proxy_set_header    Connection          &#34;&#34;;&#10;            proxy_http_version  1.1;&#10;            proxy_pass          http://localhost:3444;&#10;        &#125;&#10;    &#125;&#10;    server &#123;&#10;        listen       80;&#10;        server_name  local.dstatics.shenba.com;&#10;&#10;        root   /Users/CoderQ/shenba/code/dstatics.shenba.com;&#10;&#10;        #&#23383;&#20307;&#36328;&#22495;&#10;        location ~* \.(eot|ttf|woff|js)$ &#123;&#10;            add_header Access-Control-Allow-Origin *;&#10;        &#125;&#10;    &#125;&#10;&#10;    # another virtual host using mix of IP-, name-, and port-based configuration&#10;    #&#10;    #server &#123;&#10;    #    listen       8000;&#10;    #    listen       somename:8080;&#10;    #    server_name  somename  alias  another.alias;&#10;&#10;    #    location / &#123;&#10;    #        root   html;&#10;    #        index  index.html index.htm;&#10;    #    &#125;&#10;    #&#125;&#10;&#10;&#10;    # HTTPS server&#10;    #&#10;    #server &#123;&#10;    #    listen       443 ssl;&#10;    #    server_name  localhost;&#10;&#10;    #    ssl_certificate      cert.pem;&#10;    #    ssl_certificate_key  cert.key;&#10;&#10;    #    ssl_session_cache    shared:SSL:1m;&#10;    #    ssl_session_timeout  5m;&#10;&#10;    #    ssl_ciphers  HIGH:!aNULL:!MD5;&#10;    #    ssl_prefer_server_ciphers  on;&#10;&#10;    #    location / &#123;&#10;    #        root   html;&#10;    #        index  index.html index.htm;&#10;    #    &#125;&#10;    #&#125;&#10;&#10;&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/nginx/">nginx</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-create-openssl-certificate-for-https" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/02/create-openssl-certificate-for-https/" class="article-date">
  	<time datetime="2016-03-02T11:59:33.000Z" itemprop="datePublished">2016-03-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/02/create-openssl-certificate-for-https/">通过OpenSSL创建证书文件构建https服务</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h2><p>以前用node.js构建过https服务，很简单，就是把两个文件的路径放在代码里，把http协议换成https就搞定了。不过今天我收到的是一个文件夹，两个文件怎么用都报错，于是有了自己生成证书文件来证实问题出在哪里的想法。最后发现问题在于这个文件夹里全是—–BEGIN CERTIFICATE—–的文件，找不到一个—–BEGIN RSA PRIVATE KEY—–的文件。</p>
<h2 id="OpenSSL_u751F_u6210_u8BC1_u4E66"><a href="#OpenSSL_u751F_u6210_u8BC1_u4E66" class="headerlink" title="OpenSSL生成证书"></a>OpenSSL生成证书</h2><ul>
<li><p>创建openssl.cnf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[req]  &#10;    distinguished_name = req_distinguished_name  &#10;    req_extensions = v3_req  &#10;  &#10;    [req_distinguished_name]  &#10;    countryName = Country Name (2 letter code)  &#10;    countryName_default = CN  &#10;    stateOrProvinceName = State or Province Name (full name)  &#10;    stateOrProvinceName_default = BeiJing  &#10;    localityName = Locality Name (eg, city)  &#10;    localityName_default = YaYunCun  &#10;    organizationalUnitName  = Organizational Unit Name (eg, section)  &#10;    organizationalUnitName_default  = Domain Control Validated  &#10;    commonName = Internet Widgits Ltd  &#10;    commonName_max  = 64  &#10;  &#10;    [ v3_req ]  &#10;    # Extensions to add to a certificate request  &#10;    basicConstraints = CA:FALSE  &#10;    keyUsage = nonRepudiation, digitalSignature, keyEncipherment  &#10;    subjectAltName = @alt_names  &#10;  &#10;    [alt_names]  &#10;&#9;#&#27880;&#24847;&#36825;&#20010;IP.1&#30340;&#35774;&#32622;&#65292;IP&#22320;&#22336;&#38656;&#35201;&#21644;&#20320;&#30340;&#26381;&#21153;&#22120;&#30340;&#30417;&#21548;&#22320;&#22336;&#19968;&#26679;&#10;    IP.1 = 127.0.0.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>为CA生成私钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out ca-key.pem -des 1024</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过CA私钥生成CSR</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key ca-key.pem -out ca-csr.pem</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过CSR文件和私钥生成CA证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -in ca-csr.pem -signkey ca-key.pem -out ca-cert.pem</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过服务器私钥文件和CSR文件生成服务器证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -CA ca-cert.pem -CAkey ca-key.pem -CAcreateserial -in server-csr.pem -out server-cert.pem -extensions v3_req -extfile openssl.cnf</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="node-js_u670D_u52A1_u7AEF"><a href="#node-js_u670D_u52A1_u7AEF" class="headerlink" title="node.js服务端"></a>node.js服务端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var https = require(&#39;https&#39;);&#10;var fs = require(&#39;fs&#39;);&#10;&#10;var options = &#123;&#10;&#9;key: fs.readFileSync(&#39;./keys/server-key.pem&#39;),&#10;&#9;// ca: [fs.readFileSync(&#39;./keys/ca-cert.pem&#39;)],&#10;&#9;cert: fs.readFileSync(&#39;./keys/server-cert.pem&#39;)&#10;&#125;;&#10;&#10;https.createServer(options,function(req,res)&#123;&#10;&#9;res.writeHead(200);&#10;&#9;res.end(&#39;hello world\n&#39;);&#10;&#125;).listen(3000,&#39;127.0.0.1&#39;);</span><br></pre></td></tr></table></figure>
<h2 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="https://cnodejs.org/topic/54745ac22804a0997d38b32d" target="_blank" rel="external">https://cnodejs.org/topic/54745ac22804a0997d38b32d</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-decode-utf8" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/29/decode-utf8/" class="article-date">
  	<time datetime="2016-02-29T00:05:06.000Z" itemprop="datePublished">2016-02-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/29/decode-utf8/">html中UTF8编码的解码</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我们写爬虫爬回来的一些页面可能是编码后的utf8码，这时候我们需要对他们进行解码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var code10, code16, zh;&#10;&#10;code10 = &#39;&#38;#22825;&#38;#22530;&#38;#21521;&#38;#24038;,&#38;#28145;&#38;#22323;&#38;#21521;&#38;#21491;&#39;;&#10;&#10;zh = code10.replace(/&#38;#(\d+);/g, function($, $1) &#123;return String.fromCodePoint($1)&#125;);&#10;&#10;console.log(zh);&#10;&#10;code16 = zh.replace(/[^\u0000-\u00ff]/g, function($) &#123;return &#39;&#38;#x&#39; + $.codePointAt(0).toString(16) + &#39;;&#39;;&#125;);&#10;&#10;console.log(code16);&#10;&#10;zh = code16.replace(/&#38;#x(\w+);/g, function($, $1) &#123;return String.fromCodePoint(parseInt($1, 16))&#125;);&#10;&#10;console.log(zh);</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/html/">html</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 CoderQ
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>