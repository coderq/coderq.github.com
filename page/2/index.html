<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>CoderQ·博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="CoderQ·博客">
<meta property="og:url" content="http://coderq.github.io/page/2/index.html">
<meta property="og:site_name" content="CoderQ·博客">
<meta property="og:description" content="个人博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CoderQ·博客">
<meta name="twitter:description" content="个人博客">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xqex1.com1.z0.glb.clouddn.com/avatar%2F1426483393_DXGAJIiR.jpeg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">CoderQ</a></h1>
		</hgroup>

		
		<p class="header-subtitle">不积硅步无以至千里(旧博客地址：http://blog.coderq.net)</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>標籤</li>
						
						
						<li>關於</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/coderq" title="github">github</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/highlight/" style="font-size: 10px;">highlight</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/http/" style="font-size: 16.67px;">http</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/mongodb/" style="font-size: 16.67px;">mongodb</a> <a href="/tags/msgpack/" style="font-size: 10px;">msgpack</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nginx/" style="font-size: 13.33px;">nginx</a> <a href="/tags/node-js/" style="font-size: 13.33px;">node.js</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/opencv/" style="font-size: 10px;">opencv</a> <a href="/tags/orientdb/" style="font-size: 13.33px;">orientdb</a> <a href="/tags/redis/" style="font-size: 16.67px;">redis</a> <a href="/tags/ssl/" style="font-size: 10px;">ssl</a> <a href="/tags/微信/" style="font-size: 10px;">微信</a> <a href="/tags/状态码/" style="font-size: 10px;">状态码</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">CoderQ</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://7xqex1.com1.z0.glb.clouddn.com/avatar%2F1426483393_DXGAJIiR.jpeg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">CoderQ</h1>
			</hgroup>
			
			<p class="header-subtitle">不积硅步无以至千里(旧博客地址：http://blog.coderq.net)</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/coderq" title="github">github</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-weixin-jssdk" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/18/weixin-jssdk/" class="article-date">
  	<time datetime="2016-03-17T23:58:57.000Z" itemprop="datePublished">2016-03-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/18/weixin-jssdk/">实现记录微信分享路径树的功能</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u80CC_u666F"><a href="#u80CC_u666F" class="headerlink" title="背景"></a>背景</h2><p>接运营要求，希望记录文章被某个人分享出去之后的路径树，但因为微信分享时是无法获取到用户信息的，所以能记录的信息只有原始分享用户以及他分享出去后的路径树。</p>
<h2 id="u5B9E_u73B0_u65B9_u6CD5"><a href="#u5B9E_u73B0_u65B9_u6CD5" class="headerlink" title="实现方法"></a>实现方法</h2><p>当文章被分享出去时，我们的URL里记录有文章ID及用户ID，当页面被打开时，后端会生成一个share_id，以query的方式加到当前URL的后面，当页面被再次分享出去时，后端会根据这个share_id再生成一个下级的share_id，并记录他们之间的关系，而之前的share_id在数据库里的记录会被更新为已读。</p>
<h2 id="u5FAE_u4FE1_u7B7E_u540D_u751F_u6210_u89C4_u5219"><a href="#u5FAE_u4FE1_u7B7E_u540D_u751F_u6210_u89C4_u5219" class="headerlink" title="微信签名生成规则"></a>微信签名生成规则</h2><p>签名的生成需要以下四个参数</p>
<ul>
<li>jsapi_ticket 先通过appId获取access_token，在通过access_token获取jsapi_ticket</li>
<li>noncestr 随机字符串</li>
<li>timestamp 时间戳（秒级）</li>
<li>url 当前页面URL，<em>是当前页面URL，而不是要分享出去的URL</em><br>最后形成一段与此类似的字符串<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jsapi_ticket=sM4AOVdWfPE4DxkXGEs8VMCPGGVi4C3VM0P37wVUCFvkVAy_90u5h9nbSlYy3-Sl-HhTdfl2fzFy1AOcHKP7qg&#38;noncestr=Wm3WZYTPz0wzccnW&#38;timestamp=1414587457&#38;url=http://mp.weixin.qq.com?params=value</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在经过sha1加密，得到signature</p>
<h2 id="u6570_u636E_u6A21_u578B"><a href="#u6570_u636E_u6A21_u578B" class="headerlink" title="数据模型"></a>数据模型</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var WeixinShareLogSchema = new Schema(&#123;&#10;    _id: &#123;type: String, unique: true, required: true&#125;,&#10;    parent_id: &#123;type: String, ref: &#39;weixin_share_log&#39;&#125;,&#10;    article_id: &#123;type: ObjectId, ref: &#39;article&#39;, required: true&#125;,&#10;    is_read: &#123;type: Boolean, default: false&#125;,&#10;    created_by : &#123;type : String, required: true&#125;,&#10;    created_at : &#123;type : Date, default : Date.now&#125;&#10;&#125;);&#10;&#36890;&#36807;&#36825;&#31181;&#32467;&#26500;&#65292;&#25105;&#20204;&#21482;&#35201;&#25628;&#32034;created_by&#20877;&#21152;&#19978;&#21069;&#31471;&#30340;&#24322;&#27493;&#23454;&#29616;&#23601;&#33021;&#30693;&#36947;&#34987;&#35813;&#29992;&#25143;&#20998;&#20139;&#20986;&#21435;&#30340;&#25991;&#31456;&#30340;&#26641;&#29366;&#32467;&#26500;&#20102;&#12290;</span><br></pre></td></tr></table></figure>
<h2 id="u540E_u7AEF_u5B9E_u73B0"><a href="#u540E_u7AEF_u5B9E_u73B0" class="headerlink" title="后端实现"></a>后端实现</h2><p><em>因项目历史原因，没有使用es6</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">......&#10;// &#20998;&#20139;ID&#65292;&#22914;&#26524;&#26159;&#31532;&#19968;&#27425;&#20998;&#20139;&#65292;&#21017;&#20026;&#29992;&#25143;ID&#10;var parent_id = this.request.query.share_id || &#39;&#39;;&#10;// &#29983;&#25104;&#19968;&#20010;&#19979;&#32423;&#20998;&#20139;ID&#10;var share_id = md5(parent_id + Date.now());&#10;var WeixinShareLogModel = mongoose.model(&#39;weixinsharelog&#39;);&#10;// &#23558;&#24403;&#21069;&#30340;&#20998;&#20139;ID&#32622;&#20026;&#24050;&#35835;&#10;var e_weixin_share_log = yield WeixinShareLogModel.findOne(&#123;_id: parent_id&#125;).exec();&#10;if (e_weixin_share_log) &#123;&#10;    e_weixin_share_log.is_read = true;&#10;    yield e_weixin_share_log.save();&#10;&#125;&#10;e_weixin_share_log = new WeixinShareLogModel(&#123;&#10;    _id: share_id,&#10;    parent_id: parent_id,&#10;    article_id: article_id,&#10;    created_by: user_id&#10;&#125;);&#10;yield e_weixin_share_log.save();&#10;// url&#23450;&#20041;&#24494;&#20449;&#35201;&#27714;&#30340;&#29992;&#20110;&#33719;&#21462;&#31614;&#21517;&#30340;&#22320;&#22336;&#65292;&#38500;#&#21495;&#20043;&#21518;&#30340;&#21097;&#20313;&#37096;&#20998;&#10;var url = Tools.format(&#39;&#123;protocol&#125;://&#123;host&#125;&#123;url&#125;&#39;, &#123;&#10;    protocol: config.protocol,&#10;    host: config.host,&#10;    url: this.url.split(&#39;#&#39;).shift()&#10;&#125;);&#10;// &#33719;&#21462;&#24494;&#20449;&#31614;&#21517;&#10;var sign = yield Tools.getWeixinSignature(url);&#10;// &#29983;&#25104;&#19979;&#32423;&#20998;&#20139;&#22320;&#22336;&#10;var share_url = Tools.format(&#39;&#123;url&#125;?share_id=&#123;share_id&#125;&#39;, &#123;&#10;    url: url.split(&#39;?&#39;).shift(),&#10;    share_id: share_id&#10;&#125;);&#10;......</span><br></pre></td></tr></table></figure></p>
<p>获取微信签名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * &#33719;&#21462;&#24494;&#20449;&#31614;&#21517;&#10; */&#10;var getWeixinSignature = function* (url) &#123;&#10;    function* getWeixinTicket() &#123;&#10;        var data = yield request.get(format(config.weixin.path.access_token, config.weixin));&#10;        return yield request.get(format(config.weixin.path.ticket, &#123;access_token: data.access_token&#125;));&#10;    &#125;&#10;    try &#123;&#10;        var data, expire, nonce_str, timestamp, jsapi_ticket, signature;&#10;        // &#22914;&#26524;&#36807;&#26399;&#26102;&#38388;&#19981;&#23384;&#22312;&#25110;&#20165;&#23384;200&#31186;&#65292;&#21017;&#37325;&#26032;&#33719;&#21462;jsapi_ticket&#65292;&#24182;&#37325;&#32622;&#36807;&#26399;&#26102;&#38388;&#10;        if (!getWeixinSignature.expire || getWeixinSignature.expire &#62; new Date() - 200 * 1000) &#123;&#10;            data = yield getWeixinTicket();&#10;            getWeixinSignature.expire = data.expires_in * 1000 + new Date().getTime();&#10;            getWeixinSignature.jsapi_ticket = data.ticket;&#10;        &#125;&#10;        if (!getWeixinSignature.jsapi_ticket) return false;&#10;        nonce_str = randomString(16);&#10;        timestamp = Math.floor(new Date().getTime() / 1000);&#10;        signature = sha1(format(&#34;jsapi_ticket=&#123;jsapi_ticket&#125;&#38;noncestr=&#123;nonce_str&#125;&#38;timestamp=&#123;timestamp&#125;&#38;url=&#123;url&#125;&#34;, &#123;&#10;            jsapi_ticket: getWeixinSignature.jsapi_ticket,&#10;            nonce_str: nonce_str,&#10;            timestamp: timestamp,&#10;            url: url&#10;        &#125;));&#10;        return &#123;&#10;            appId: config.weixin.app_id,&#10;            timestamp: timestamp,&#10;            nonceStr: nonce_str,&#10;            signature: signature&#10;        &#125;&#10;    &#125; catch (e) &#123;&#10;        console.log(e.stack);&#10;        return false;&#10;    &#125;&#10;&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="u524D_u7AEF_u914D_u7F6E"><a href="#u524D_u7AEF_u914D_u7F6E" class="headerlink" title="前端配置"></a>前端配置</h2><ul>
<li>引入文件<a href="https://res.wx.qq.com/open/js/jweixin-1.0.0.js" target="_blank" rel="external">https://res.wx.qq.com/open/js/jweixin-1.0.0.js</a></li>
<li>定义配置信息<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wx.config(&#123;&#10;    debug: false, &#10;    appId: &#39;&#60;%= sign.appId %&#62;&#39;,&#10;    nonceStr: &#39;&#60;%= sign.nonceStr %&#62;&#39;,&#10;    timestamp: &#39;&#60;%= sign.timestamp %&#62;&#39;,&#10;    signature: &#39;&#60;%= sign.signature %&#62;&#39;,&#10;    jsApiList: [&#10;        &#34;onMenuShareTimeline&#34;,&#10;        &#34;onMenuShareAppMessage&#34;,&#10;        &#34;onMenuShareQQ&#34;,&#10;        &#34;onMenuShareWeibo&#34;,&#10;        &#34;hideOptionMenu&#34;,&#10;        &#34;showOptionMenu&#34;&#10;    ]&#10;&#125;);&#10;wx.ready(function() &#123;&#10;&#9;var desc = $(&#39;meta[name=description]&#39;).attr(&#39;content&#39;) || $(&#39;body&#39;).find(&#39;h1,h2,h3,h4,p&#39;).eq(0).text() || &#39;&#32654;&#20029;&#38405;&#35835;&#25991;&#31456;&#20998;&#20139;&#39;;&#10;&#9;var image_url = $(&#39;body&#39;).find(&#39;img&#39;).get(0).src;&#10;    var shareInfo = &#123;&#10;        title: &#39;&#60;%= article_title %&#62;&#39;,&#10;        desc: desc,&#10;        imgUrl: image_url,&#10;        link: &#39;&#60;%= share_url %&#62;&#39;&#10;    &#125;;&#10;    /*&#20998;&#20139;&#21040;&#26379;&#21451;&#22280;*/&#10;    wx.onMenuShareTimeline(shareInfo);&#10;    //&#33719;&#21462;&#8220;&#20998;&#20139;&#32473;&#26379;&#21451;&#8221;&#25353;&#38062;&#28857;&#20987;&#29366;&#24577;&#21450;&#33258;&#23450;&#20041;&#20998;&#20139;&#20869;&#23481;&#25509;&#21475;&#10;    wx.onMenuShareAppMessage(shareInfo);&#10;    //&#33719;&#21462;&#8220;&#20998;&#20139;&#21040;QQ&#8221;&#25353;&#38062;&#28857;&#20987;&#29366;&#24577;&#21450;&#33258;&#23450;&#20041;&#20998;&#20139;&#20869;&#23481;&#25509;&#21475;&#10;    wx.onMenuShareQQ(shareInfo);&#10;    //&#33719;&#21462;&#8220;&#20998;&#20139;&#21040;&#33150;&#35759;&#24494;&#21338;&#8221;&#25353;&#38062;&#28857;&#20987;&#29366;&#24577;&#21450;&#33258;&#23450;&#20041;&#20998;&#20139;&#20869;&#23481;&#25509;&#21475;&#10;    wx.onMenuShareWeibo(shareInfo);&#10;&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>具体JSSDK配置请参考<a href="https://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html" target="_blank" rel="external">微信官方文档</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/微信/">微信</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/微信/">微信</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-javascript-proto-prototype-constructor" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/08/javascript-proto-prototype-constructor/" class="article-date">
  	<time datetime="2016-03-08T02:35:59.000Z" itemprop="datePublished">2016-03-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/08/javascript-proto-prototype-constructor/">Javascript继承之理解__proto__、prototype、constructor三者的含义与用法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u5982_u4F55_u5199_u51FA_u6CA1_u6709_u6C61_u67D3_u7684_u7EE7_u627F"><a href="#u5982_u4F55_u5199_u51FA_u6CA1_u6709_u6C61_u67D3_u7684_u7EE7_u627F" class="headerlink" title="如何写出没有污染的继承"></a>如何写出没有污染的继承</h2><p>1.javascript中一切都是对象，每个对象都是基于原型对象创建的，每个对象中都有<strong>proto</strong>属性，这个属性指向的就是它基于的原型对象。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> Foo(); </span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">    Foo.__proto__ === <span class="built_in">Function</span>.prototype, <span class="comment">// true</span></span><br><span class="line">    foo.__proto__ === Foo.prototype, <span class="comment">// true</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>2.只有构造函数对象才有prototype属性，构造函数的作用是创建对象，创建对象的时候，它要知道这个对象基于哪个原型来创建，这个prototype指向的就是这个原型。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="comment">// Foo.prototype 指向 Foo.prototype;</span></span><br></pre></td></tr></table></figure></p>
<p>3.只有原型对象才有constructor属性，而且也是系统（浏览器）给创建的。前面说过构造函数对象的prototype属性会指向一个原型对象，那么这个原型对象中的constructor属性指向的就是这个构造函数。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> Foo(); </span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">    foo.constructor === Foo, <span class="comment">// true</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>4.思想合并<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Parent = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'parent'</span>;</span><br><span class="line">&#125;;</span><br><span class="line">Parent.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Son = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Parent.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'son'</span>;</span><br><span class="line">&#125;;</span><br><span class="line">Son.prototype.__proto__ = Parent.prototype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> parent = <span class="keyword">new</span> Parent();</span><br><span class="line"><span class="keyword">var</span> son = <span class="keyword">new</span> Son();</span><br><span class="line">parent.sayName();</span><br><span class="line">son.sayName();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">    Parent.__proto__ === <span class="built_in">Function</span>.prototype,</span><br><span class="line">    parent.__proto__ === Parent.prototype,</span><br><span class="line">    parent.constructor === Parent,</span><br><span class="line">    Son.__proto__ === <span class="built_in">Function</span>.prototype,</span><br><span class="line">    son.__proto__ === Son.prototype,</span><br><span class="line">    son.constructor === Son</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h2 id="u53C2_u8003_u8D44_u6599"><a href="#u53C2_u8003_u8D44_u6599" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://www.ruanyifeng.com/blog/2011/06/designing_ideas_of_inheritance_mechanism_in_javascript.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2011/06/designing_ideas_of_inheritance_mechanism_in_javascript.html</a></li>
<li><a href="http://blogzhoubo.iteye.com/blog/1685368" target="_blank" rel="external">http://blogzhoubo.iteye.com/blog/1685368</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/javascript/">javascript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-javascript-es5-useless-tech" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/08/javascript-es5-useless-tech/" class="article-date">
  	<time datetime="2016-03-08T02:18:38.000Z" itemprop="datePublished">2016-03-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/08/javascript-es5-useless-tech/">Javascript中一些可能是用较少的语法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="set/get"><a href="#set/get" class="headerlink" title="set/get"></a>set/get</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var data = &#123;&#10;&#9;items: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;],&#10;&#9;get length () &#123;&#10;&#9;&#9;return this.items.length;&#10;&#9;&#125;,&#10;&#9;set first (val) &#123;&#10;&#9;&#9;this.items[0] = val;&#10;&#9;&#125;&#10;&#125;;&#10;console.log(data.length); // 3&#10;data.length = 4; // &#20005;&#26684;&#27169;&#24335;&#19979;&#25253;&#38169;&#65306;Uncaught TypeError: Cannot set property length of #&#60;Object&#62; which has only a getter(&#8230;)&#10;console.log(data.first = &#39;d&#39;);&#10;console.log(data.items); // [&#34;d&#34;, &#34;b&#34;, &#34;c&#34;]&#10;&#10;var MyDate = function() &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="defineGetter/defineSetter"><a href="#defineGetter/defineSetter" class="headerlink" title="defineGetter/defineSetter"></a><strong>defineGetter</strong>/<strong>defineSetter</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var data = &#123;&#10;&#9;items: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]&#10;&#125;;&#10;data.__defineGetter__(&#39;length&#39;, function() &#123;return this.items.length;&#125;);&#10;data.__defineSetter__(&#39;first&#39;, function(val) &#123;this.items[0] = val;&#125;)&#10;console.log(data.length); // 3&#10;console.log(data.first = &#39;d&#39;);&#10;console.log(data.items); // [&#34;d&#34;, &#34;b&#34;, &#34;c&#34;]</span><br></pre></td></tr></table></figure>
<h2 id="Object-freeze"><a href="#Object-freeze" class="headerlink" title="Object.freeze"></a>Object.freeze</h2><p>将某个对象<em>冻住</em>，好形象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var a = &#123;a:1, b: 2&#125;; &#10;Object.freeze(a); &#10;a.c =3;&#10;console.log(a); // &#123;a: 1, b: 2&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Object-defineProperty"><a href="#Object-defineProperty" class="headerlink" title="Object.defineProperty"></a>Object.defineProperty</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var obj1 = &#123;&#125;;&#10;Object.defineProperty(obj1, &#34;x&#34;, &#123; value: 42, writable: false &#125;);&#10;obj1.x = 9; // &#20005;&#26684;&#27169;&#24335;&#19979;&#25243;&#20986;TypeError&#38169;&#35823;&#10;console.log(obj1.x); // 42</span><br></pre></td></tr></table></figure>
<h2 id="Object-preventExtensions"><a href="#Object-preventExtensions" class="headerlink" title="Object.preventExtensions"></a>Object.preventExtensions</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#32473;&#19981;&#21487;&#25193;&#23637;&#23545;&#35937;&#30340;&#26032;&#23646;&#24615;&#36171;&#20540;&#10;var fixed = &#123;&#125;;&#10;Object.preventExtensions(fixed);&#10;fixed.newProp = &#34;ohai&#34;; // &#20005;&#26684;&#27169;&#24335;&#19979;&#25243;&#20986;TypeError&#38169;&#35823;&#10;console.log(fixed); // &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(new Function(&#39;a&#39;, &#39;b&#39;, &#39;return a + b;&#39;)(1, 2)) // 3</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/javascript/">javascript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-npm-useful-logs" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/08/npm-useful-logs/" class="article-date">
  	<time datetime="2016-03-07T23:48:25.000Z" itemprop="datePublished">2016-03-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/08/npm-useful-logs/">npm命令使用</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>npm install</code> will install both “dependencies” and “devDependencies”</p>
<p><code>npm install --production</code> will only install “dependencies”</p>
<p><code>npm install --dev</code> will only install “devDependencies”</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/npm/">npm</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/npm/">npm</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-nginx-config" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/03/nginx-config/" class="article-date">
  	<time datetime="2016-03-03T00:41:07.000Z" itemprop="datePublished">2016-03-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/03/nginx-config/">nginx配置</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u5168_u5C40_u914D_u7F6E"><a href="#u5168_u5C40_u914D_u7F6E" class="headerlink" title="全局配置"></a>全局配置</h2><h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><p>用于指定nginx进程运行用户以及用户组，默认情况下将使用与用户名相同的组，除非编译时指定–user=USER和–group=GROUP</p>
<h3 id="worker_processes"><a href="#worker_processes" class="headerlink" title="worker_processes"></a>worker_processes</h3><p>用于指定nginx的进程数，一般设置为与CPU核数一致即可。</p>
<h3 id="error_log"><a href="#error_log" class="headerlink" title="error_log"></a>error_log</h3><p>用于指定全局错误日志文件，日志错误级别包括debug,info,notice,warn,error,crit，日志的信息量由debug到crit递减。</p>
<p>nginx支持为每个虚拟主机配置不同的日志文件，如果在编译安装的时候加入–with-debug参数，可以使用以下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_log LOGFILE [debug_core | debug_alloc | debug_mutex | debug_event | debug_http | debug_imap];</span><br></pre></td></tr></table></figure></p>
<p><strong>error_log off</strong>并不能关闭日志记录，而会将日志文件写入另一个文件名为off的文件中，如果你想关闭错误日志功能 ，应使用以下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_log  /dev/null crit;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;&#10;worker_processes  auto;&#10;&#10;#error_log  logs/error.log;&#10;#error_log  logs/error.log  notice;&#10;#error_log  logs/error.log  info;&#10;&#10;#pid        logs/nginx.pid;&#10;&#10;events &#123;&#10;    worker_connections  1024;&#10;    multi_accept on;&#10;&#125;&#10;&#10;http &#123;&#10;    include       mime.types;&#10;    default_type  application/octet-stream;&#10;&#10;    server_tokens   off;&#10;    sendfile        on;&#10;    tcp_nopush      on;&#10;    tcp_nodelay     on;&#10;&#10;    keepalive_timeout  65;&#10;    &#10;    server &#123;&#10;        listen 80;&#10;        server_name local.tms.shenba.com;&#10;&#10;        location / &#123;&#10;            proxy_set_header Host $host;&#10;            proxy_set_header X-Real-IP $remote_addr;&#10;            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;            proxy_buffering off;&#10;            proxy_pass           http://localhost:3445;&#10;        &#125;&#10;&#10;        &#10;    &#125;&#10;&#10;    server &#123;&#10;        listen 80;&#10;        server_name local.h5.shenba.com;&#10;&#10;        location / &#123;&#10;            proxy_set_header Host $host;&#10;            proxy_set_header X-Real-IP $remote_addr;&#10;            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;            proxy_buffering off;&#10;            proxy_pass           http://localhost:3446;&#10;        &#125;&#10;    &#125;&#10;&#10;    server &#123;&#10;        listen 80;&#10;        server_name local.h5statics.shenba.com;&#10;&#10;        root /Users/CoderQ/shenba/code/h5statics.shenba.com;&#10;    &#125;&#10;&#10;    server &#123;&#10;        listen 80;&#10;        server_name local.dian.shenba.com;&#10;        #access_log /var/log/nginx/node_h5site.log&#10;        location / &#123;&#10;            proxy_set_header    X-Real-IP           $remote_addr;&#10;            proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;&#10;            proxy_set_header    Host                $http_host;&#10;            proxy_set_header    X-NginX-Proxy       true;&#10;            proxy_set_header    Connection          &#34;&#34;;&#10;            proxy_http_version  1.1;&#10;            proxy_pass          http://localhost:3444;&#10;        &#125;&#10;    &#125;&#10;    server &#123;&#10;        listen       80;&#10;        server_name  local.dstatics.shenba.com;&#10;&#10;        root   /Users/CoderQ/shenba/code/dstatics.shenba.com;&#10;&#10;        #&#23383;&#20307;&#36328;&#22495;&#10;        location ~* \.(eot|ttf|woff|js)$ &#123;&#10;            add_header Access-Control-Allow-Origin *;&#10;        &#125;&#10;    &#125;&#10;&#10;    # another virtual host using mix of IP-, name-, and port-based configuration&#10;    #&#10;    #server &#123;&#10;    #    listen       8000;&#10;    #    listen       somename:8080;&#10;    #    server_name  somename  alias  another.alias;&#10;&#10;    #    location / &#123;&#10;    #        root   html;&#10;    #        index  index.html index.htm;&#10;    #    &#125;&#10;    #&#125;&#10;&#10;&#10;    # HTTPS server&#10;    #&#10;    #server &#123;&#10;    #    listen       443 ssl;&#10;    #    server_name  localhost;&#10;&#10;    #    ssl_certificate      cert.pem;&#10;    #    ssl_certificate_key  cert.key;&#10;&#10;    #    ssl_session_cache    shared:SSL:1m;&#10;    #    ssl_session_timeout  5m;&#10;&#10;    #    ssl_ciphers  HIGH:!aNULL:!MD5;&#10;    #    ssl_prefer_server_ciphers  on;&#10;&#10;    #    location / &#123;&#10;    #        root   html;&#10;    #        index  index.html index.htm;&#10;    #    &#125;&#10;    #&#125;&#10;&#10;&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/nginx/">nginx</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-create-openssl-certificate-for-https" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/02/create-openssl-certificate-for-https/" class="article-date">
  	<time datetime="2016-03-02T11:59:33.000Z" itemprop="datePublished">2016-03-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/02/create-openssl-certificate-for-https/">通过OpenSSL创建证书文件构建https服务</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h2><p>以前用node.js构建过https服务，很简单，就是把两个文件的路径放在代码里，把http协议换成https就搞定了。不过今天我收到的是一个文件夹，两个文件怎么用都报错，于是有了自己生成证书文件来证实问题出在哪里的想法。最后发现问题在于这个文件夹里全是—–BEGIN CERTIFICATE—–的文件，找不到一个—–BEGIN RSA PRIVATE KEY—–的文件。</p>
<h2 id="OpenSSL_u751F_u6210_u8BC1_u4E66"><a href="#OpenSSL_u751F_u6210_u8BC1_u4E66" class="headerlink" title="OpenSSL生成证书"></a>OpenSSL生成证书</h2><ul>
<li><p>创建openssl.cnf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[req]  &#10;    distinguished_name = req_distinguished_name  &#10;    req_extensions = v3_req  &#10;  &#10;    [req_distinguished_name]  &#10;    countryName = Country Name (2 letter code)  &#10;    countryName_default = CN  &#10;    stateOrProvinceName = State or Province Name (full name)  &#10;    stateOrProvinceName_default = BeiJing  &#10;    localityName = Locality Name (eg, city)  &#10;    localityName_default = YaYunCun  &#10;    organizationalUnitName  = Organizational Unit Name (eg, section)  &#10;    organizationalUnitName_default  = Domain Control Validated  &#10;    commonName = Internet Widgits Ltd  &#10;    commonName_max  = 64  &#10;  &#10;    [ v3_req ]  &#10;    # Extensions to add to a certificate request  &#10;    basicConstraints = CA:FALSE  &#10;    keyUsage = nonRepudiation, digitalSignature, keyEncipherment  &#10;    subjectAltName = @alt_names  &#10;  &#10;    [alt_names]  &#10;&#9;#&#27880;&#24847;&#36825;&#20010;IP.1&#30340;&#35774;&#32622;&#65292;IP&#22320;&#22336;&#38656;&#35201;&#21644;&#20320;&#30340;&#26381;&#21153;&#22120;&#30340;&#30417;&#21548;&#22320;&#22336;&#19968;&#26679;&#10;    IP.1 = 127.0.0.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>为CA生成私钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out ca-key.pem -des 1024</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过CA私钥生成CSR</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key ca-key.pem -out ca-csr.pem</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过CSR文件和私钥生成CA证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -in ca-csr.pem -signkey ca-key.pem -out ca-cert.pem</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过服务器私钥文件和CSR文件生成服务器证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -CA ca-cert.pem -CAkey ca-key.pem -CAcreateserial -in server-csr.pem -out server-cert.pem -extensions v3_req -extfile openssl.cnf</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="node-js_u670D_u52A1_u7AEF"><a href="#node-js_u670D_u52A1_u7AEF" class="headerlink" title="node.js服务端"></a>node.js服务端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var https = require(&#39;https&#39;);&#10;var fs = require(&#39;fs&#39;);&#10;&#10;var options = &#123;&#10;&#9;key: fs.readFileSync(&#39;./keys/server-key.pem&#39;),&#10;&#9;// ca: [fs.readFileSync(&#39;./keys/ca-cert.pem&#39;)],&#10;&#9;cert: fs.readFileSync(&#39;./keys/server-cert.pem&#39;)&#10;&#125;;&#10;&#10;https.createServer(options,function(req,res)&#123;&#10;&#9;res.writeHead(200);&#10;&#9;res.end(&#39;hello world\n&#39;);&#10;&#125;).listen(3000,&#39;127.0.0.1&#39;);</span><br></pre></td></tr></table></figure>
<h2 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="https://cnodejs.org/topic/54745ac22804a0997d38b32d" target="_blank" rel="external">https://cnodejs.org/topic/54745ac22804a0997d38b32d</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssl/">ssl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/ssl/">ssl</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-decode-utf8" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/29/decode-utf8/" class="article-date">
  	<time datetime="2016-02-29T00:05:06.000Z" itemprop="datePublished">2016-02-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/29/decode-utf8/">html中UTF8编码的解码</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我们写爬虫爬回来的一些页面可能是编码后的utf8码，这时候我们需要对他们进行解码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var code10, code16, zh;&#10;&#10;code10 = &#39;&#38;#22825;&#38;#22530;&#38;#21521;&#38;#24038;,&#38;#28145;&#38;#22323;&#38;#21521;&#38;#21491;&#39;;&#10;&#10;zh = code10.replace(/&#38;#(\d+);/g, function($, $1) &#123;return String.fromCodePoint($1)&#125;);&#10;&#10;console.log(zh);&#10;&#10;code16 = zh.replace(/[^\u0000-\u00ff]/g, function($) &#123;return &#39;&#38;#x&#39; + $.codePointAt(0).toString(16) + &#39;;&#39;;&#125;);&#10;&#10;console.log(code16);&#10;&#10;zh = code16.replace(/&#38;#x(\w+);/g, function($, $1) &#123;return String.fromCodePoint(parseInt($1, 16))&#125;);&#10;&#10;console.log(zh);</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/">html</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/html/">html</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-mongodb-update-by-self-field" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/27/mongodb-update-by-self-field/" class="article-date">
  	<time datetime="2016-02-27T00:09:14.000Z" itemprop="datePublished">2016-02-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/27/mongodb-update-by-self-field/">mongodb的文档如何通过自己的某些字段更新文档的方法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u4EC5_u4EC5_u6539_u53D8Key"><a href="#u4EC5_u4EC5_u6539_u53D8Key" class="headerlink" title="仅仅改变Key"></a>仅仅改变Key</h2><p>如果你的值没有问题，只是你的key出现了问题，需要修改key，可以使用$rename来做简单的处理<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// init</span></span><br><span class="line">db.events.insert(&#123; <span class="string">'lat'</span>: <span class="number">1</span>, <span class="string">'lon'</span>: <span class="number">2</span>, someotherdata: [] &#125;)</span><br><span class="line">db.events.insert(&#123; <span class="string">'lat'</span>: <span class="number">4</span>, <span class="string">'lon'</span>: <span class="number">1</span>, someotherdata: [] &#125;)</span><br><span class="line"><span class="comment">// doit</span></span><br><span class="line">db.events.update(&#123;&#125;, &#123;$rename: &#123;<span class="string">'lat'</span>: <span class="string">'coords.lat'</span>, <span class="string">'lon'</span>: <span class="string">'coords.lon'</span>&#125;&#125;, <span class="literal">false</span>, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// result</span></span><br><span class="line">db.events.find()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span> : ObjectId(<span class="string">"5113c82dd28c4e8b79971add"</span>),</span><br><span class="line">    <span class="string">"coords"</span> : &#123;</span><br><span class="line">        <span class="string">"lat"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="string">"lon"</span> : <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"someotherdata"</span> : [ ]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span> : ObjectId(<span class="string">"5113c82ed28c4e8b79971ade"</span>),</span><br><span class="line">    <span class="string">"coords"</span> : &#123;</span><br><span class="line">        <span class="string">"lat"</span> : <span class="number">4</span>,</span><br><span class="line">        <span class="string">"lon"</span> : <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"someotherdata"</span> : [ ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u4FEE_u590DKey_u548CValue"><a href="#u4FEE_u590DKey_u548CValue" class="headerlink" title="修复Key和Value"></a>修复Key和Value</h2><p>如果你的value也出现问题，那么仅仅rename是无济于事的，你可以用下面的方法来处理整个collection。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">db.events.find().snapshot().forEach(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// update document, using its own properties</span></span><br><span class="line">    e.coords = &#123; lat: e.lat, lon: e.lon &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// remove old properties</span></span><br><span class="line">    <span class="keyword">delete</span> e.lat;</span><br><span class="line">    <span class="keyword">delete</span> e.lon;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save the updated document</span></span><br><span class="line">    db.events.save(e);</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>查看<a href="http://stackoverflow.com/questions/3788256/mongodb-updating-documents-using-data-from-the-same-document/3792958#3792958" target="_blank" rel="external">stackoverflow</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongodb/">mongodb</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/mongodb/">mongodb</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-javascript-merge-sort" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/22/javascript-merge-sort/" class="article-date">
  	<time datetime="2016-02-21T17:12:35.000Z" itemprop="datePublished">2016-02-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/22/javascript-merge-sort/">javascript实现合并排序</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> merge = <span class="function"><span class="keyword">function</span>(<span class="params">ary, p, q, r</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// eg. ary = [4, 1], p = 0, q = 0, r = 1</span></span><br><span class="line">	<span class="keyword">var</span> l_ary = ary.slice(p, q + <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">var</span> r_ary = ary.slice(q + <span class="number">1</span>, r + <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">var</span> b_ary;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (l_ary.length &amp;&amp; r_ary.length) &#123;</span><br><span class="line">		ary[p++] = l_ary[<span class="number">0</span>] &lt;= r_ary[<span class="number">0</span>] ? l_ary.shift() : r_ary.shift();	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	b_ary = l_ary.length ? l_ary : r_ary;</span><br><span class="line">	<span class="keyword">while</span> (b_ary.length) &#123;</span><br><span class="line">		ary[p++] = b_ary.shift();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(ary);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> merge_sort = <span class="function"><span class="keyword">function</span>(<span class="params">ary, s, e</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> m;</span><br><span class="line">	<span class="keyword">if</span> (s === e) <span class="keyword">return</span>;</span><br><span class="line">	m = <span class="built_in">Math</span>.floor((s + e) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	merge_sort(ary, s, m);</span><br><span class="line">	merge_sort(ary, m + <span class="number">1</span>, e);</span><br><span class="line">	merge(ary, s, m, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> do_merge_sort = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> ary = [<span class="number">4</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(ary);</span><br><span class="line">	merge_sort(ary, <span class="number">0</span>, ary.length - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(ary);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">do_merge_sort();</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/javascript/">javascript</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-opencv-ippicv-macosx" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/19/opencv-ippicv-macosx/" class="article-date">
  	<time datetime="2016-02-18T16:12:35.000Z" itemprop="datePublished">2016-02-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/19/opencv-ippicv-macosx/">用cmake安装opencv遇到缺少ippicv-macosx-*.*文件的解决方案</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>既然出错，那么你一定可以看到报错提示，大致如下。这里面你收获了第一个关键信息<em>expected hash: [4ff1fde9a7cfdfe7250bfcd8334e0f2f]</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for file: [/Users/CoderQ/Downloads/opencv-3.1.0/3rdparty/ippicv/downloads/macosx-4ff1fde9a7cfdfe7250bfcd8334e0f2f/ippicv_macosx_20151201.tgz]&#10;  expected hash: [4ff1fde9a7cfdfe7250bfcd8334e0f2f]&#10;    actual hash: [cc09c2a46b5dd28acea8e1e78e296670]&#10;         status: [28;&#34;Timeout was reached&#34;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>上搜索引擎搜<em>4ff1fde9a7cfdfe7250bfcd8334e0f2f</em>，你会发现第一个搜索结果指向了<a href="http://code.metager.de/source/xref/lib/opencv/3rdparty/ippicv/downloader.cmake" target="_blank" rel="external">源码地址</a></p>
</li>
<li><p>代码里<em>OPENCV_ICV_PACKAGE_HASH</em>这个变量指向了<em>4ff1fde9a7cfdfe7250bfcd8334e0f2f</em>。</p>
</li>
<li><p>之后你会找到这行代码，他告诉你这个URL地址还需要另一个变量<em>OPENCV_ICV_URL</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file(DOWNLOAD &#34;$&#123;OPENCV_ICV_URL&#125;/$&#123;OPENCV_ICV_PACKAGE_NAME&#125;&#34; &#34;$&#123;OPENCV_ICV_PACKAGE_ARCHIVE&#125;&#34;</span><br></pre></td></tr></table></figure>
</li>
<li><p>之后根据源码你可以拼出这个地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://raw.githubusercontent.com/Itseez/opencv_3rdparty/81a676001ca8075ada498583e4166079e5744668/ippicv/ippicv_macosx_20151201.tgz</span><br></pre></td></tr></table></figure>
</li>
<li><p>把文件下载后放在提示的地址，重新安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Users/CoderQ/Downloads/opencv-3.1.0/3rdparty/ippicv/downloads/macosx-4ff1fde9a7cfdfe7250bfcd8334e0f2f/ippicv_macosx_20151201.tgz</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/opencv/">opencv</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/opencv/">opencv</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 CoderQ
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>